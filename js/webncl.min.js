var Logger={WARN_INVALID_ATTR:100,WARN_INVALID_TAG:101,WARN_INVALID_HEAD_STRUCTURE:102,WARN_INVALID_REGION_DIMENSIONS:103,WARN_DUPLICATED_ZINDEX:104,WARN_INVALID_AREA:105,WARN_NOT_IMPLEMENTED_YET:106,ERR_MISSING_ATTR:201,ERR_MISSING_ATTR_ONEOF:202,ERR_MISSING_ATTR_DEP:203,ERR_TOO_MANY_ATTRS:204,ERR_MISSING_TAG:205,ERR_MISSING_TAG_ONEOF:206,ERR_TOO_MANY_TAGS:207,ERR_TOO_MANY_TAGS_ONEOF:208,ERR_INVALID_ATTR_VALUE:209,ERR_INVALID_ID_REFERENCE:210,ERR_DUPLICATED_ID:211,ERR_INCOMPATIBLE_FILE_EXT:212,ERR_INVALID_URI:213,
ERR_DUPLICATED_ATTR:214,ERR_DUPLICATED_ALIAS:215,ERR_INVALID_CONTEXT_REFERENCE:216,ERR_MEDIAPLAYER_METHOD_NOTFOUND:301,ERR_MEDIAPLAYER_NOPLAYER:302,MESSAGES:{100:"Atributo inv\u00e1lido",101:"Tag inv\u00e1lida",102:"Estrutura do cabe\u00e7alho inv\u00e1lida",103:"Dimens\u00f5es de regi\u00e3o inv\u00e1lidas",104:"zIndex duplicado",105:"Areaa invalida",106:"Recurso n\u00e3o implementado ainda",201:"Atributo obrigat\u00f3rio faltando",202:"Atributo obrigat\u00f3rio faltando (um desses)",203:"Atributo dependente faltando",
204:"Excesso de atributos repetidos",205:"Tag obrigat\u00f3ria faltando",206:"Tag obrigat\u00f3ria faltando (uma dessas)",207:"Excesso de tags repetidas",208:"Excesso de tags (apenas uma permitida)",209:"Valor de atributo inv\u00e1lido",210:"Refer\u00eancia a ID inv\u00e1lido",211:"ID duplicado",212:"Extens\u00e3o de arquivo incompat\u00edvel com o MIMETYPE",213:"URI inv\u00e1lida",214:"Atributo duplicado",215:"Alias duplicado",216:"Objeto referenciado em outro contexto",301:"M\u00e9todo n\u00e3o encontrado no media player",
302:"Nenhum player foi definido para este mime type/extens\u00e3o"},abort:!1,error:function(a,b,c){console.error("["+a+"] "+this.MESSAGES[a]+"\n"+b+": "+c.join(","));this.abort=!0},warning:function(a,b,c){console.warn("["+a+"] "+this.MESSAGES[a]+"\n"+b+": "+c.join(","))}};function Timer(a,b,c){c&&(this.manager=c);this.callback=b;this.timeLeft=a;this.id=this.startTime=null}Timer.prototype.timeout=function(){this.manager&&this.manager.remove(this);this.callback()};Timer.prototype.resume=function(){this.startTime=new Date;this.id=setTimeout($.proxy(function(){this.timeout()},this),this.timeLeft)};Timer.prototype.pause=function(){clearTimeout(this.id);this.timeLeft-=new Date-this.startTime};Timer.prototype.stop=function(){clearTimeout(this.id)};
function TimerManager(){this.timers=[]}TimerManager.prototype.add=function(a,b){this.timers.push(new Timer(a,b,this))};TimerManager.prototype.remove=function(a){this.timers.splice(this.timers.indexOf(a),1)};TimerManager.prototype.pauseAll=function(){for(i in this.timers)this.timers[i].pause()};TimerManager.prototype.resumeAll=function(){for(i in this.timers)this.timers[i].resume()};TimerManager.prototype.stopAll=function(){for(i in this.timers)this.timers[i].stop();this.timers=[]};function WebNclPlayer(a,b,c){c&&"/"!=c[c.length-1]&&(c+="/");var d=/[\/]*.+\//g;this.div=b;this.presentation={readyToPlay:!1,playRequested:!1,TIME_LIMIT:1E3,settingsNode:void 0,playerId:++WebNclPlayer.playerCount,playerDiv:b,getDivId:function(a,b){return"ncl"+this.playerId+(b||"")+"_"+(this.parser.referenceMap.instReuse[a]||a)},path:c||a&&d.exec(a)[0]||"",mediaPlayers:{"text/htm":{defaultPlayer:Html5Player},image:{defaultPlayer:Html5Player},audio:{defaultPlayer:Html5Player},video:{defaultPlayer:Html5Player},
"video/x-flv":{defaultPlayer:FlowPlayer},"text/css":void 0,"text/html":{defaultPlayer:Html5Player},"text/plain":{defaultPlayer:Html5Player},"application/x-ginga-NCLua":{defaultPlayer:LuaPlayer},"application/x-ginga-NCLet":void 0,"application/x-ginga-settings":{defaultPlayer:Html5Player},"text/xml":void 0},keyEvents:{}};b=this.presentation.playerId;this.presentation.bodyDiv="wncl_body"+b;this.presentation.settingsDiv="wncl_settings"+b;this.presentation.contextsDiv="wncl_contexts"+b;this.presentation.loadingDiv=
"wncl_loading"+b;this.presentation.playDiv="wncl_play"+b;this.presentation.endDiv="wncl_end"+b;this.presentation.keys={CURSOR_UP:38,CURSOR_DOWN:40,CURSOR_LEFT:37,CURSOR_RIGHT:39,ENTER:13,RED:81,GREEN:87,YELLOW:69,BLUE:82,KEY_0:96,KEY_1:97,KEY_2:98,KEY_3:99,KEY_4:100,KEY_5:101,KEY_6:102,KEY_7:103,KEY_8:104,KEY_9:105,BACK:90,EXIT:88,PLAY:67,STOP:86,PAUSE:66,RECORD:78,POWER:65,REWIND:83,EJECT:68,MENU:77};this.presentation.reverseKeys=Array(120);for(var e in this.presentation.keys)this.presentation.reverseKeys[this.presentation.keys[e]]=
e;this.presentation.keys.allCodes=[13,37,38,39,40,81,87,69,82,96,97,98,99,100,101,102,103,104,105,90,88,67,86,66,78,65,83,68];this.presentation.postEvent=$.proxy(this.postEvent,this);this.presentation.isPlaying=!1;this.presentation.isStopped=!0;this.presentation.playingElem=[];this.presentation.pausedElem=[];this.presentation.notifyLink=$.proxy(this.nAction,this);this.presentation.lastMediaAborted=!1;a?$.ajax({type:"GET",url:a,dataType:"xml",success:$.proxy(function(a){this.execute(a)},this)}):(a=
document.URL.split("/"),a=a[a.length-1],$.ajax({type:"GET",url:a,dataType:"text",success:$.proxy(function(a){this.execute($($.parseXML(a)).find("#"+this.div)[0])},this)}))}
WebNclPlayer.prototype.execute=function(a){var b=new Date,c,d;this.presentation.parser=new Parser;this.presentation.ncl=this.presentation.parser.parse(a);console.log('Player "'+this.div+'" loaded in '+(new Date-b)+"ms");this.presentation.inputManager=new InputManager(this.presentation);this.presentation.systemSettings=new SystemSettings(this.presentation);a=$("#"+this.presentation.playerDiv);for(c in this.presentation.ncl.head.regionBase)for(d in this.presentation.ncl.head.regionBase[c].region)b=
{left:0,top:0,width:parseInt(a.css("width").split("px")[0]),height:parseInt(a.css("height").split("px")[0])},this.fixRegionBounds(this.presentation.ncl.head.regionBase[c].region[d],b);a.attr("tabindex",this.presentation.playerId);a.append("<div id='"+this.presentation.loadingDiv+"' class='wncl_BlackDiv' style='display:none;'><image src='images/loader1.gif' width='32' height='32' style='position:relative; left: 50%; top: 50%; margin-top: -16px; margin-left:-16px'/></div>");a.append("<div id='"+this.presentation.playDiv+
"' class='wncl_BlackDiv wncl_clickMe' ><image src='images/play.png' width='48' height='48' style='position:relative; left: 50%; top: 50%; margin-top: -24px; margin-left:-24px'/></div>");a.append("<div id='"+this.presentation.endDiv+"' class='wncl_BlackDiv wncl_clickMe' style='display:none;'><image src='images/replay.png' width='48' height='48' style='position:relative; left: 50%; top: 50%; margin-top: -24px; margin-left:-24px'/></div>");a.append("<div id='"+this.presentation.settingsDiv+"'></div>");
a.append("<div id='"+this.presentation.contextsDiv+"'></div>");this.presentation.context=new ContextPlayer(this.presentation.ncl.body,this.presentation);$("#"+this.presentation.playDiv).on("click",$.proxy(function(){this.presentation.context.isStopped?this.start():this.presentation.context.isPlaying||this.resume()},this));$("#"+this.presentation.endDiv).on("click",$.proxy(function(){this.start()},this));this.presentation.readyToPlay=!0;this.presentation.playRequested&&this.start()};
WebNclPlayer.prototype.fixRegionBounds=function(a,b){var c={left:a.left||null,right:a.right||null,top:a.top||null,bottom:a.bottom||null,width:a.width||null,height:a.height||null},d={left:0,top:0,width:0,height:0};for(i in c)null!=c[i]&&1==c[i].split("%").length&&(c[i]=parseInt(c[i].split("px")[0]));var e,f;e=["left","right","width"];for(i in e)null!=c[e[i]]&&isNaN(c[e[i]])&&(f=c[e[i]].split("%"),0<f.length&&(c[e[i]]=parseInt(b.width*parseFloat(f[0])/100)));e=["top","bottom","height"];for(i in e)null!=
c[e[i]]&&isNaN(c[e[i]])&&(f=c[e[i]].split("%"),1<f.length&&(c[e[i]]=parseInt(b.height*parseInt(f[0])/100)));null!=c.left?null!=c.right?null==c.width&&(c.width=b.width-c.left-c.right):null==c.width&&(c.width=b.width):null!=c.width?c.left=null!=c.right?b.width-c.right-c.width:0:null!=c.right?(c.left=0,c.width=b.width-c.right):(c.left=0,c.width=b.width);null!=c.top?null!=c.bottom?null==c.height&&(c.height=b.height-c.top-c.bottom):null==c.height&&(c.height=b.height):null!=c.height?c.top=null!=c.bottom?
b.height-c.bottom-c.height:0:null!=c.bottom?(c.top=0,c.height=b.height-c.bottom):(c.top=0,c.height=b.height);d.left=b.left+c.left;d.top=b.top+c.top;d.width=c.width;d.height=c.height;a.left=d.left+"px";a.top=d.top+"px";a.width=d.width+"px";a.height=d.height+"px";a.right=null;a.bottom=null;for(i in a.region)this.fixRegionBounds(a.region[i],d)};WebNclPlayer.prototype.destroy=function(){document.getElementById(this.div).outerHTML=""};
WebNclPlayer.prototype.start=function(){this.presentation.readyToPlay?this.presentation.context.start():this.presentation.playRequested=!0};WebNclPlayer.prototype.pause=function(){this.presentation.context.pause()};WebNclPlayer.prototype.resume=function(){this.presentation.context.resume()};WebNclPlayer.prototype.abort=function(){this.presentation.context.abort()};WebNclPlayer.prototype.stop=function(){this.presentation.context.stop();this.presentation.playRequested=!1;$("#"+this.presentation.endDiv).show()};
WebNclPlayer.prototype.triggerEvent=function(a,b,c){$("#"+this.presentation.getDivId(b)).trigger(a,[c])};WebNclPlayer.prototype.setProperty=function(a,b,c){$("#"+this.presentation.getDivId(a)).trigger("set",[b,null,null,c])};WebNclPlayer.prototype.keyPress=function(a){this.presentation.keys[a]?this.presentation.inputManager.keyEvent(this.presentation.keys[a]):this.presentation.inputManager.keyEvent(a)};
WebNclPlayer.prototype.postEvent=function(a){if(!a["class"]||"ncl"==a["class"])if(!a.type||"presentation"==a.type)if(a.component)this.triggerEvent(a.action,a.component,a.area);else switch(a.action){case "start":this.start();break;case "pause":this.pause();break;case "resume":this.resume();break;case "abort":this.abort();break;case "stop":this.stop();break;case "destroy":this.destroy()}else"attribution"==a.type&&"start"==a.action&&this.setProperty(a.component,a.name,a.value);else"key"==a["class"]&&
(!a.type||"press"==a.type)&&this.keyPress(a.key)};WebNclPlayer.prototype.triggerEvent=function(a,b,c){$("#"+this.presentation.getDivId(b)).trigger(a,[c])};WebNclPlayer.prototype.nSync=function(){};WebNclPlayer.prototype.nAction=function(){var a=this.presentation,b="#"+a.playDiv,c="#"+a.endDiv;0===a.playingElem.length?0===a.pausedElem.length?(a.isStopped=!0,a.isPlaying=!1,$(c).show()):(a.isStopped=!1,a.isPlaying=!1,$(b).show()):a.isPlaying||($(b).hide(),$(c).hide(),a.isStopped=!1,a.isPlaying=!0)};
WebNclPlayer.playerCount=0;
$(document).ready(function(){var a="";$("nclplayer").each(function(){var b=$(this).attr("src"),c=$(this).attr("id"),d=$(this).attr("autoplay"),e=$(this).attr("baseDir");this.outerHTML='<div id="'+c+'" class="nclPlayer_'+c+'"> </div>';a+=".nclPlayer_"+c+" {\tposition: relative;\tleft: "+($(this).attr("left")||"0px")+";\ttop: "+($(this).attr("top")||"0px")+";\twidth: "+($(this).attr("width")||"854px")+";\theight: "+($(this).attr("height")||"480px")+";}";webNclPlayers.push(new WebNclPlayer(b,c,e));d&&
webNclPlayers[webNclPlayers.length-1].start()});a+=".context, #contexts, #settings {\tdisplay: none;}.player {\tposition: absolute;\tleft: 0px;\ttop: 0px;\toverflow: hidden;\tdisplay: inline;\t-o-object-position: 0 0;}.playerBkg {\tposition: absolute;\toverflow: hidden;\tdisplay: none;}.wncl_BlackDiv {    position:absolute;    width:100%;    height:100%;    z-index: 999;    background-color:rgba(0,0,0,0.8);}.wncl_clickMe {    cursor:pointer;}";$("<style>").text(a).appendTo("head")});
webNclPlayers=[];function InputManager(a){this.presentation=a;var a=a.ncl.head.descriptorBase.descriptor,b=[],c;for(c in a){var d=a[c];d.focusIndex&&(b.push(d.focusIndex),this.descriptors[d.focusIndex]={self:d,mediaArray:[]})}this.bindKeyDown()}
InputManager.prototype.addMedia=function(a,b){if(a in this.descriptors){var c=this.descriptors[a];-1==c.mediaArray.indexOf(b)&&(c.mediaArray.push(b),this.bindMouseEvents(a,b));-1==$.inArray(a,this.focusIndexArray)&&this.focusIndexArray.push(a);void 0==this.currentFocusIndex?this.__setCurrentFocus(a):this.currentFocusIndex==a&&this.setMediaFocus(b)}};
InputManager.prototype.removeMedia=function(a,b){if(-1!=$.inArray(a,this.focusIndexArray)){var c=this.descriptors[a],d=c.mediaArray.indexOf(b);-1!=d&&(c.mediaArray.splice(d,1),this.removeMediaFocus(b),this.unbindMouseEvents(b));0==c.mediaArray.length&&this.focusIndexArray.splice(this.focusIndexArray.indexOf(a),1);a==this.currentFocusIndex&&(0==this.focusIndexArray.length?this.__setCurrentFocus(void 0):(this.focusIndexArray.sort(this.sortFunction),this.__setCurrentFocus(this.focusIndexArray[0])))}};
InputManager.prototype.__setCurrentFocus=function(a){this.presentation.settingsNode&&void 0!=a?(htmlPlayer=this.presentation.settingsNode.htmlPlayer,$(htmlPlayer).trigger("set",["service.currentFocus",null,null,a])):this.setCurrentFocus(a)};
InputManager.prototype.setCurrentFocus=function(a){if(void 0==a)this.currentFocusIndex=void 0;else if(-1!=this.focusIndexArray.indexOf(a)){if(this.currentFocusIndex){var b=this.descriptors[this.currentFocusIndex],c;for(c in b.mediaArray){var d=currentDescriptor.mediaArray[c];this.removeMediaFocus(d)}}currentDescriptor=this.descriptors[a];for(c in currentDescriptor.mediaArray)d=currentDescriptor.mediaArray[c],this.setMediaFocus(d);this.currentFocusIndex=a;return!0}return!1};
InputManager.prototype.getCurrentFocus=function(){return this.currentFocusIndex};InputManager.prototype.setMediaFocus=function(a){$(a).trigger("focus")};InputManager.prototype.removeMediaFocus=function(a){$(a).trigger("blur")};InputManager.prototype.bindKeyDown=function(){$("#"+this.presentation.playerDiv).on("keydown",$.proxy(function(a){-1!=this.presentation.keys.allCodes.indexOf(a.which)&&(a.preventDefault(),this.keyEvent(a.which))},this))};InputManager.prototype.unbindKeyDown=function(){$(window).off("keydown")};
InputManager.prototype.keyEvent=function(a){this.triggerKeyEvents(a);if(this.currentFocusIndex){currentDescriptor=this.descriptors[this.currentFocusIndex];var b=this.presentation.keys;switch(a){case b.CURSOR_UP:currentDescriptor.self.moveUp&&this.__setCurrentFocus(currentDescriptor.self.moveUp.focusIndex);break;case b.CURSOR_DOWN:currentDescriptor.self.moveDown&&this.__setCurrentFocus(currentDescriptor.self.moveDown.focusIndex);break;case b.CURSOR_LEFT:currentDescriptor.self.moveLeft&&this.__setCurrentFocus(currentDescriptor.self.moveLeft.focusIndex);
break;case b.CURSOR_RIGHT:currentDescriptor.self.moveRight&&this.__setCurrentFocus(currentDescriptor.self.moveRight.focusIndex);break;case b.ENTER:for(var c in currentDescriptor.mediaArray)currentMedia=currentDescriptor.mediaArray[c],$(currentMedia).trigger("selection.onSelection")}}};
InputManager.prototype.bindMouseEvents=function(a,b){$(b).css("cursor","pointer");$(b).on("click",$.proxy(function(a){1==a.which&&this.keyEvent(this.presentation.keys.ENTER)},this));$(b).on("mouseover",{focusIndex:a},$.proxy(function(a){this.__setCurrentFocus(a.data.focusIndex)},this))};InputManager.prototype.unbindMouseEvents=function(a){$(a).off("click");$(a).off("mouseover");$(a).css("cursor","default")};
InputManager.prototype.enableKeys=function(a){a&&a in this.presentation.keyEvents&&(this.presentation.keyEvents[a]=!0)};InputManager.prototype.disableKeys=function(a){a&&a in this.presentation.keyEvents&&(this.presentation.keyEvents[a]=!1)};InputManager.prototype.triggerKeyEvents=function(a){for(var b in this.presentation.keyEvents)if(this.presentation.keyEvents[b]){var c=$.Event("selection.onSelection");c.which=a;$(b).trigger(c)}};InputManager.prototype.currentFocusIndex=void 0;
InputManager.prototype.descriptors={};InputManager.prototype.focusIndexArray=[];InputManager.sortFunction=function(a,b){a=(""+a).toLowerCase();b=(""+b).toLowerCase();return a>b?1:a<b?-1:0};function Listener(a,b,c,d,e,f,g){this.listenerType=a;this.actionOperator=b;this.actionMap=c;this.flagMap=d;this.assessmentStatements=e;this.last=new Date;this.triggerBuffer=void 0;this.presentation=f;this.pendingActions=0;this.contextsUsed=g;this.actionNamesArray=[];for(actionName in c)this.actionNamesArray.push(actionName);this.actionMapSize=this.actionNamesArray.length}Listener.prototype.notifyContexts=function(){for(var a in this.contextsUsed)this.contextsUsed[a].notifyLink(-1)};
Listener.prototype.notifyEvent=function(a){switch(this.listenerType){case Listener.listenerType.SIMPLE:this.__verifyAssessmentStatements()&&this.__executeActions();break;case Listener.listenerType.AND:if((new Date).valueOf()-this.last.valueOf()>this.presentation.TIME_LIMIT){for(var b in this.flagMap)this.flagMap[b].flag=!1;this.flagMap[a].flag=!0;this.last=new Date}else{a=this.flagMap[a].flag=!0;for(b in this.flagMap)if(!this.flagMap[b].flag){a=!1;break}if(a){for(b in this.flagMap)this.flagMap[b].flag=
!1;this.last=0;this.__verifyAssessmentStatements()&&this.__executeActions()}}break;case Listener.listenerType.OR:(new Date).valueOf()-this.last.valueOf()>this.presentation.TIME_LIMIT&&(this.last=new Date,this.__executeActions())}};
Listener.prototype.__verifyAssessmentStatements=function(){for(var a in this.assessmentStatements){var b=this.assessmentStatements[a],c=$(b.bindComponent).data("property")[b.bindInterface];switch(b.operator){case "eq":if(c!=b.value)return!1;break;case "ne":if(c==b.value)return!1;break;case "lt":if(!(c<b.value))return!1;break;case "lte":if(!(c<=b.value))return!1;break;case "gt":if(!(c>b.value))return!1;break;case "gte":if(!(c>=b.value))return!1}}return!0};
Listener.prototype.__executeActions=function(){this.pendingActions=this.actionMapSize;for(var a in this.contextsUsed)this.contextsUsed[a].notifyLink(1);"seq"==this.actionOperator?this.__executeActionsSeq([0]):this.__executeActionsPar()};Listener.prototype.__executeActionsSeq=function(a){a=a[0];a<this.actionNamesArray.length&&this.__callTriggers([this.actionNamesArray[a],a])};Listener.prototype.__executeActionsPar=function(){for(var a in this.actionMap)this.__callTriggers([a,-1])};
Listener.prototype.__callTriggers=function(a){var b=a[0],a=a[1];"seq"==this.actionMap[b].qualifier?this.__callTriggersSeq([b,a,0]):this.__callTriggersPar([b,a])};Listener.prototype.__actionEnded=function(a){a[1].splice(0,1);if(a[0])a[0](a[1]);this.pendingActions--;0==this.pendingActions&&this.notifyContexts()};
Listener.prototype.__callTriggersSeq=function(a){var b=a[0],c=a[1],a=a[2],d=this.actionMap[b].binds,e=d[a];0<=c?0==a&&0==c?a==d.length-1?this.triggerBuffer.push([e.bindComponent,b,[e.bindInterface,$.proxy(this.__actionEnded,this),[$.proxy(this.__executeActionsSeq,this),[b,c+1]],e.value]]):this.triggerBuffer.push([e.bindComponent,b,[e.bindInterface,$.proxy(this.__callTriggersSeq,this),[b,c,a+1],e.value]]):a<d.length-1?$(e.bindComponent).trigger(b,[e.bindInterface,$.proxy(this.__callTriggersSeq,this),
[b,c,a+1],e.value]):$(e.bindComponent).trigger(b,[e.bindInterface,$.proxy(this.__actionEnded,this),[$.proxy(this.__executeActionsSeq,this),[b,c+1]],e.value]):0==a?a==d.length-1?this.triggerBuffer.push([e.bindComponent,b,[e.bindInterface,$.proxy(this.__actionEnded,this),[null,[b,null]],e.value]]):this.triggerBuffer.push([e.bindComponent,b,[e.bindInterface,$.proxy(this.__callTriggersSeq,this),[b,c,a+1],e.value]]):a<d.length-1?$(e.bindComponent).trigger(b,[e.bindInterface,$.proxy(this.__callTriggersSeq,
this),[b,c,a+1],e.value]):$(e.bindComponent).trigger(b,[e.bindInterface,$.proxy(this.__actionEnded,this),[null,[b,null]],e.value])};Listener.prototype.__parTriggerEnded=function(a){var b=a[1],a=this.actionMap[a[0]];a.pendingAcks--;0==a.pendingAcks&&(this.pendingActions--,0==this.pendingActions?this.notifyContexts():0<=b&&this.__executeActionsSeq([b+1]))};
Listener.prototype.__callTriggersPar=function(a){var b=a[0],a=a[1],c=this.actionMap[b],d;c.pendingAcks=c.binds.length;for(var e in c.binds)d=c.binds[e],0>=a?this.triggerBuffer.push([d.bindComponent,b,[d.bindInterface,$.proxy(this.__parTriggerEnded,this),[b,a],d.value]]):$(d.bindComponent).trigger(b,[d.bindInterface,$.proxy(this.__parTriggerEnded,this),[b,a],d.value])};Listener.listenerType={SIMPLE:0,AND:1,OR:2};function SystemSettings(a){this.settings={"default.focusBorderColor":"blue","default.selBorderColor":"yellow","default.focusBorderWidth":2,"default.focusBorderTransparency":0,"service.currentKeyMaster":""};this.setMap={"service.currentFocus":$.proxy(a.inputManager.setCurrentFocus,a.inputManager)};this.getMap={"service.currentFocus":$.proxy(a.inputManager.getCurrentFocus,a.inputManager)}}
SystemSettings.prototype.setPropertyValue=function(a,b){if(a in this.settings)this.settings[a]=b;else if(a in this.setMap)this.setMap[a](b);else return!1;return!0};SystemSettings.prototype.getPropertyValue=function(a){if(a in this.settings)return this.settings[a];if(a in this.setMap)return this.getMap[a]()};Parser.isNotArray="ncl,head,body,importedDocumentBase,ruleBase,transitionBase,descriptorBase,connectorBase,defaultDescriptor,valueAssessment,defaultComponent".split(",");
Parser.nclStructureMap={area:{attrs:{reference_target:["id"],required:["id"],optional:"coords,begin,end,beginText,endText,beginPosition,endPosition,first,last,label,clip".split(",")},content:{}},assessmentStatement:{attrs:{required:["comparator"]},content:{custom:["attributeAssessment","valueAssessment"],validate:function(a,b){var c=a.attributeAssessment,d=a.valueAssessment;0==c&&b.push({code:Logger.ERR_MISSING_TAG,params:["attributeAssessment"]});2>c&&0==d&&b.push({code:Logger.ERR_MISSING_TAG_ONEOF,
params:["attributeAssessment","valueAssessment"]});2==c&&0<d&&b.push({code:Logger.ERR_TOO_MANY_TAGS_ONEOF,params:["attributeAssessment","valueAssessment"]});2<c&&b.push({code:Logger.ERR_TOO_MANY_TAGS,params:["attributeAssessment"]});1<d&&b.push({code:Logger.ERR_TOO_MANY_TAGS,params:["valueAssessment"]})}}},attributeAssessment:{attrs:{required:["role","eventType","attributeType"],optional:["key","offset"]},content:{}},bind:{attrs:{reference_source:[[["descriptor"],["descriptor"]],[["component"],["context",
"media"]],[["nodeInterface"],["port","area","property"]]],required:["role","component"],optional:["interface","descriptor"]},content:{star:["bindParam"]}},bindParam:{attrs:{required:["name","value"]},content:{}},bindRule:{attrs:{reference_source:[[["constituent"],["media"]],[["rule"],["rule"]]],required:["constituent","rule"]},content:{}},body:{attrs:{reference_target:["id"],optional:["id"]},content:{star:"port,property,media,context,switch,link".split(",")}},causalConnector:{attrs:{reference_target:["id"],
required:["id"]},content:{star:["connectorParam"],custom:["simpleCondition","compoundCondition","simpleAction","compoundAction"],validate:function(a,b){0==a.simpleCondition&&0==a.compoundCondition?b.push({code:Logger.ERR_MISSING_TAG_ONEOF,params:["simpleCondition","compoundCondition"]}):0<a.simpleCondition&&0<a.compoundCondition?b.push({code:Logger.ERR_TOO_MANY_TAGS_ONEOF,params:["simpleCondition","compoundCondition"]}):1<a.simpleCondition?b.push({code:Logger.ERR_TOO_MANY_TAGS,params:["simpleCondition"]}):
1<a.compoundCondition&&b.push({code:Logger.ERR_TOO_MANY_TAGS,params:["compoundCondition"]});0==a.simpleAction&&0==a.compoundAction?b.push({code:Logger.ERR_MISSING_TAG_ONEOF,params:["simpleAction","compoundAction"]}):0<a.simpleAction&&0<a.compoundAction?b.push({code:Logger.ERR_TOO_MANY_TAGS_ONEOF,params:["simpleAction","compoundAction"]}):1<a.simpleAction?b.push({code:Logger.ERR_TOO_MANY_TAGS,params:["simpleAction"]}):1<a.compoundAction&&b.push({code:Logger.ERR_TOO_MANY_TAGS,params:["compoundAction"]})}}},
compositeRule:{attrs:{required:["id","operator"]},content:{plusOneOf:["rule","compositeRule"]}},compoundAction:{attrs:{required:["operator"],optional:["delay"]},content:{plusOneOf:["simpleAction","compoundAction"]}},compoundCondition:{attrs:{required:["operator"],optional:["delay"]},content:{plusOneOf:["simpleCondition","compoundCondition"],star:["assessmentStatement","compoundStatement"]}},compoundStatement:{attrs:{required:["operator"],optional:["isNegated"]},content:{plusOneOf:["assessmentStatement",
"compoundStatement"]}},connectorBase:{attrs:{optional:["id"]},content:{star:["importBase","causalConnector"]}},connectorParam:{attrs:{reference_target:["name"],ref_group:!0,required:["name"],optional:["type"]},content:{}},context:{attrs:{reference_source:[[["refer"],["body","context"]]],reference_target:["id"],required:["id"],optional:["refer"]},content:{star:"port,property,media,context,switch,link".split(",")}},defaultComponent:{attrs:{reference_source:[[["component"],["context","media"]]],required:["component"]},
content:{}},defaultDescriptor:{attrs:{reference_source:[[["descriptor"],["descriptor"]]],required:["descriptor"]},content:{}},descriptor:{attrs:{reference_source:[[["region"],["region"]],[["moveLeft","moveRight","moveUp","moveDown"],["focusIndex"]],[["transIn","transOut"],["transition"]]],reference_target:["id","focusIndex"],required:["id"],optional:"player,explicitDur,region,freeze,moveLeft,moveRight,moveUp,moveDown,focusIndex,focusBorderColor,focusBorderWidth,focusBorderTransparency,focusSrc,focusSelSrc,selBorderColor,transIn,transOut".split(",")},
content:{star:["descriptorParam"]}},descriptorBase:{attrs:{optional:["id"]},content:{plusOneOf:["importBase","descriptor","descriptorSwitch"]}},descriptorParam:{attrs:{required:["name","value"]},content:{}},descriptorSwitch:{attrs:{required:["id"]},content:{optional:["defaultDescriptor"],star:["bindRule","descriptor"]}},head:{attrs:{},content:{optional:["importedDocumentBase","ruleBase","transitionBase","descriptorBase","connectorBase"],star:["regionBase","meta","metadata"]}},importBase:{attrs:{reference_source:[[["region"],
["region"]]],required:["alias","documentURI"],optional:["region"]},content:{}},importedDocumentBase:{attrs:{optional:["id"]},content:{plus:["importNCL"]}},importNCL:{attrs:{required:["alias","documentURI"]},content:{}},link:{attrs:{reference_source:[[["xconnector"],["causalConnector"]]],required:["xconnector"],optional:["id"]},content:{plus:["bind"],star:["linkParam"]}},linkParam:{attrs:{required:["name","value"]},content:{}},mapping:{attrs:{reference_source:[[["component"],["context","media"]],[["nodeInterface"],
["port","area","property"]]],required:["component"],optional:["interface"]},content:{}},media:{attrs:{reference_source:[[["refer"],["media"]],[["descriptor"],["descriptor"]]],reference_target:["id"],required:["id"],optional:["instance","descriptor"],oneOf:["type","src","refer"]},content:{star:["area","property"]}},meta:{attrs:{required:["name","content"]},content:{}},metadata:{attrs:{},content:{}},ncl:{attrs:{optional:["id","title","xmlns"]},content:{optional:["head","body"]}},port:{attrs:{reference_source:[[["component"],
["context","media"]],[["nodeInterface"],["port","area","property"]]],reference_target:["id"],required:["id","component"],optional:["interface"]},content:{}},property:{attrs:{reference_target:["name"],ref_group:!0,required:["name"],optional:["value"]},content:{}},region:{attrs:{reference_target:["id"],required:["id"],optional:"title,left,right,top,bottom,height,width,zIndex".split(",")},content:{star:["region"]}},regionBase:{attrs:{optional:["id","device"]},content:{plusOneOf:["importBase","region"]}},
rule:{attrs:{reference_source:[[["var"],["property"]]],required:["id","var","comparator","value"]},content:{}},ruleBase:{attrs:{optional:["id"]},content:{plusOneOf:["importBase","rule","compositeRule"]}},simpleAction:{attrs:{required:["role"],optional:"delay,eventType,actionType,value,min,max,qualifier,repeat,repeatDelay,duration,by".split(",")},content:{}},simpleCondition:{attrs:{required:["role"],optional:"delay,eventType,key,transition,min,max,qualifier".split(",")},content:{}},"switch":{attrs:{reference_source:[[["refer"],
["switch"]]],reference_target:["id"],required:["id"],optional:["refer"]},content:{optional:["defaultComponent"]}},switchPort:{attrs:{required:["id"]},content:{plus:["mapping"]}},transition:{attrs:{ref_multiple:!0,reference_target:["id"],required:["id","type"],optional:"subtype,dur,startProgress,endProgress,direction,fadeColor,horRepeat,vertRepeat,borderWidth,borderColor".split(",")},content:{}},transitionBase:{attrs:{optional:["id"]},content:{plusOneOf:["importBase","transition"]}},valueAssessment:{attrs:{required:["value"]},
content:{}}};function Parser(){this.referenceMap={map:[],instReuse:[],addSource:function(a,b,c){this.map[a[b]]||(this.map[a[b]]={sources:[]});this.map[a[b]].sources.push({obj:a,attr:b,type:c})},addTarget:function(a,b,c,d){var e=!1;if(this.map[b])if(this.map[b].target)if("property"==d||"connectorParam"==d){if(this.map[b].target.parents[c])return!1}else return!1;else e=!0;else this.map[b]={sources:[]},e=!0;e&&(this.map[b].target={obj:a,type:d,parents:[]});return this.map[b].target.parents[c]=!0},pop:function(a){return this.map[a]?
this.map[a].target:!1},createReferences:function(){for(id in this.map)for(i in this.map[id].sources){var a=this.map[id].sources[i];this.map[id].target&&this.map[id].target.obj&&-1!=$.inArray(this.map[id].target.type,a.type)?"refer"==a.attr?"media"==a.obj._type&&(a.obj.descriptor=this.map[id].target.obj.descriptor,a.obj.src=this.map[id].target.obj.src,a.obj.type=this.map[id].target.obj.type,"new"!=a.obj.instance&&(this.instReuse[a.obj.id]=id)):a.obj[a.attr]=this.map[id].target.obj:Logger.error(Logger.ERR_INVALID_ID_REFERENCE,
a.type,[a.attr,a.obj[a.attr],a.type])}}};this.uniqueTable=[]}Parser.prototype.parse=function(a){this.ncl=this.createNode(a);this.referenceMap.createReferences();return this.ncl};
Parser.prototype.createNode=function(a,b,c,d){b=b||"ncl";a=$(a).find("ncl"==b?"ncl":"> "+b);if(0==a.length)return!1;var e=[],f=Parser.nclStructureMap[b].attrs;f.required||(f.required=[]);f.optional||(f.optional=[]);f.oneOf||(f.oneOf=[]);var g=[].concat(f.required,f.optional,f.oneOf),f=Parser.nclStructureMap[b].content;f.optional||(f.optional=[]);f.one||(f.one=[]);f.plus||(f.plus=[]);f.plusOneOf||(f.plusOneOf=[]);f.star||(f.star=[]);f.custom||(f.custom=[]);var p=[].concat(f.optional,f.one,f.plus,f.plusOneOf,
f.star,f.custom),h=this;$(a).each(function(){var a={_type:b};for(i in g)a[g[i]]=$(this).attr(g[i]);var f=d+">"+b;a.id&&(f+="#"+a.id);h.parseAttributes(this,a);h.parseContent(this,a);for(i in p)a[p[i]]=h.createNode(this,p[i],a,f);e.push(a);if("ncl"==b)h.parseNCL(a,b,c,d);else if(b[0])h["parse"+b[0].toUpperCase()+b.slice(1,b.length)](a,b,c,d)});return-1==$.inArray(b,Parser.isNotArray)?e:e[0]};
Parser.prototype.parseAttributes=function(a,b){for(var c=$(a).get(0).attributes,d=b._type,e=Parser.nclStructureMap[d].attrs,f=[],g=0;g<c.length;g++)f.push(c.item(g).name);for(g in e.reference_source)for(attr in e.reference_source[g][0])$(a).attr(e.reference_source[g][0][attr])&&this.referenceMap.addSource(b,e.reference_source[g][0][attr],e.reference_source[g][1]);for(attr in e.reference_target)$(a).attr(e.reference_target[attr])&&(c="focusIndex"==e.reference_target[attr]?"focusIndex":d,this.referenceMap.addTarget(b,
$(a).attr(e.reference_target[attr]),$(a).parent().attr("id"),c)||Logger.error(Logger.ERR_DUPLICATED_ID,d,[e.reference_target[attr],$(a).attr(e.reference_target[attr]),$(a).parent().attr("id")]));for(attr in e.required)if(c=$.inArray(e.required[attr],f),-1==c)Logger.error(Logger.ERR_MISSING_ATTR,d,[e.required[attr]]);else for(f[c]=0;c=-1!=$.inArray(e.required[attr],f);)Logger.error(Logger.ERR_TOO_MANY_ATTRS,d,[e.required[attr]]),f[c]=0;for(attr in e.optional)if(c=$.inArray(e.optional[attr],f),-1!=
c)for(f[c]=0;c=-1!=$.inArray(e.optional[attr],f);)Logger.error(Logger.ERR_TOO_MANY_ATTRS,d,[e.required[attr]]),f[c]=0;g=0==e.oneOf.length;for(attr in e.oneOf)if(c=$.inArray(e.oneOf[attr],f),-1!=c){g=!0;for(f[c]=0;c=-1!=$.inArray(e.oneOf[attr],f);)Logger.error(Logger.ERR_TOO_MANY_ATTRS,d,[e.oneOf[attr]]),f[c]=0}g||Logger.error(Logger.ERR_MISSING_ATTR_ONEOF,d,e.oneOf);for(attr in f)0!=f[attr]&&Logger.warning(Logger.WARN_INVALID_ATTR,d,[f[attr]])};
Parser.prototype.parseContent=function(a,b){var c=b._type,d=Parser.nclStructureMap[c].content,e=[],f=[],f=f.concat(d.one,d.optional,d.plus,d.plusOneOf,d.star,d.custom),g;for(g in f)e[f[g]]=0;$(a).find("> *").each(function(){var a=$(this).get(0).tagName;e[a]?e[a]++:e[a]=1});for(g in d.optional)1<e[d.optional[g]]&&Logger.error(Logger.ERR_TOO_MANY_TAGS,c,[d.optional[g]]),e[d.optional[g]]=0;for(g in d.one)1<e[d.one[g]]&&Logger.error(Logger.ERR_TOO_MANY_TAGS,c,[d.one[g]]),0==e[d.one[g]]&&Logger.error(Logger.ERR_MISSING_TAG,
c,[d.one[g]]),e[d.one[g]]=0;for(g in d.plus)0==e[d.plus[g]]&&Logger.error(Logger.ERR_MISSING_TAG,c,[d.plus[g]]),e[d.plus[g]]=0;f=0==d.plusOneOf.length;for(g in d.plusOneOf)0<e[d.plusOneOf[g]]&&(f=!0),e[d.plusOneOf[g]]=0;f||Logger.error(Logger.ERR_MISSING_TAG_ONEOF,c,d.plusOneOf);for(g in d.star)e[d.star[g]]=0;if(0<d.custom.length){d.validate(e,errors=[]);for(err in errors)Logger.error(errors[err].code,c,errors[err].params);for(g in d.custom)e[d.custom[g]]=0}for(g in e)0<e[g]&&Logger.warning(Logger.WARN_INVALID_TAG,
c,[g])};ContextPlayer.prototype=new Player;
function ContextPlayer(a,b){this.timerManager=new TimerManager;this.handlers={};this.node=a;this.media={};this.context={};this.port={};this.presentation=b.presentation||b;this.parentContext=b;this.pendingLinks=0;this.syncElem=[];this.syncReadyElem=[];this.pausedElemList=[];this.playingElem=[];this.pausedElem=[];this.isCreated=this.lastMediaAborted=!1;this.htmlPlayer=a.id?this.presentation.getDivId(a.id):this.presentation.bodyDiv;$("#"+this.presentation.contextsDiv).append("<div class='context' id='"+this.htmlPlayer+
"'></div>");this.data=$(this.htmlPlayer).data();this.htmlPlayer="#"+this.htmlPlayer;$(this.htmlPlayer).data("player",this);$(this.htmlPlayer).data("property",[]);this.bindEvents()}ContextPlayer.prototype.eventType={onBegin:"presentation",onEnd:"presentation",onAbort:"presentation",onPause:"presentation",onResume:"presentation",onSelection:"selection",onBeginAttribution:"attribution",onEndAttribution:"attribution"};
ContextPlayer.prototype.notifyLink=function(a){if(-1===a||1===a)this.pendingLinks+=a;0==this.pendingLinks&&(0===this.playingElem.length?0===this.pausedElem.length?(this.isStopped=!0,this.isPlaying=!1,this.timerManager.stopAll(),this.lastMediaAborted?this.trigger("presentation.onAbort"):this.trigger("presentation.onEnd")):(this.isPlaying=this.isStopped=!1,this.timerManager.pauseAll(),this.trigger("presentation.onPause")):this.isPlaying||(this.isStopped=!1,this.isPlaying=!0,this.timerManager.resumeAll(),
this.isStopped?this.trigger("presentation.onBegin"):this.trigger("presentation.onResume")))};ContextPlayer.prototype.nSync=function(){};
ContextPlayer.prototype.create=function(){if(!this.isCreated){this.isCreated=!0;for(i in this.node.media)this.media[this.node.media[i].id]=new MediaPlayer(this.node.media[i],this);for(i in this.node.context)this.context[this.node.context[i].id]=new ContextPlayer(this.node.context[i],this);for(i in this.node.port)this.port[this.node.port[i].id]=this.node.port[i];for(i in this.node.property)this.setProperty(this.node.property[i].name,this.node.property[i].value);this.bindLinks()}return this};
ContextPlayer.prototype.portAction=function(a,b){switch(a.component._type){case "context":if(this.context[a.component.id])if(a["interface"]){var c=a["interface"];this.context[a.component.id].create();if(this.context[a.component.id].port[c])this.context[a.component.id][b](c);else Logger.error(Logger.ERR_INVALID_CONTEXT_REFERENCE,"port",[a.id,"interface",c])}else this.context[a.component.id][b]();else Logger.error(Logger.ERR_INVALID_CONTEXT_REFERENCE,"port",["context",a.id,"component",a.component.id]);
break;case "media":if(c=a["interface"])this.media[a.component.id][b](c);else this.media[a.component.id][b]()}};ContextPlayer.prototype.start=function(a){this.isCreated||this.create();if(a)this.portAction(this.port[a],"start");else if(this.isStopped)for(i in this.port)this.portAction(this.port[i],"start")};
ContextPlayer.prototype.stop=function(a){if(a)this.portAction(this.port[a],"stop");else if(!this.isStopped){this.pausedElem=[];this.pausedElemList=[];this.playingElem=[];for(i in this.context)this.context[i].stop();for(i in this.media)this.media[i].stop()}};
ContextPlayer.prototype.pause=function(a){if(this.isPlaying)if(a)this.portAction(this.port[a],"pause");else{this.pausedElemList=this.playingElem;this.playingElem=[];for(var b in this.pausedElemList)this.pausedElemList[b].pause()}else this.portAction(this.port[a],"pause")};ContextPlayer.prototype.resume=function(a){if(a)this.portAction(this.port[a],"resume");else if(!this.isPlaying&&!this.isStopped){0<this.pausedElemList.length?(a=this.pausedElemList,this.pausedElemList=[]):a=this.pausedElem;for(var b in a)a[b].resume()}};
ContextPlayer.prototype.abort=function(a){if(a)this.portAction(this.port[a],"abort");else{this.pausedMediaList=[];this.pausedContextList=[];for(i in this.context)this.context[i].abort();for(i in this.media)this.media[i].abort()}};ContextPlayer.isVariable=function(a){return"$"==a.substring(0,1)};ContextPlayer.createLocalParamMap=function(a){var b={};for(i in a)currentBindParam=a[i],b["$"+currentBindParam.name]=currentBindParam.value;return b};
ContextPlayer.executeTriggerArray=function(a){for(var b;void 0!=(b=a.shift());)$(b[0]).trigger(b[1],b[2])};
ContextPlayer.prototype.bindLinks=function(){var a=this.node.port,b=this.node.link,c=this.handlers,d;for(d in a){var e=a[d],f="#"+this.presentation.getDivId(e.component.id),g=e.id,p;for(p in this.eventType){var h=this.eventType[p];if("attribution"!=h){var n=[h,p].join(".");$(f).on(n,{contextElement:this.htmlPlayer,interfaceId:g,eventName:n,portInterface:e["interface"]},function(a,b){if(b==a.data.portInterface){var c=$.Event(a.data.eventName);c.which=a.which;$(a.data.contextElement).trigger(c,[a.data.interfaceId])}})}}}for(d in b){var a=
b[d],l=a.xconnector,f={},g={},n=0,r="par",m=l.simpleCondition,s={},t={},k=[];if(l.connectorParam)for(d in l.connectorParam)s["$"+l.connectorParam[d].name]="";if(l.compoundCondition)for(d in m=l.compoundCondition[0].simpleCondition,1<m.length&&(n=Listener.listenerType[l.compoundCondition[0].operator.toUpperCase()]),l.compoundCondition[0].assessmentStatement){var j=l.compoundCondition[0].assessmentStatement[d];for(p in j.attributeAssessment)h=j.attributeAssessment[p],"attribution"==h.eventType&&(!h.attributeType||
"nodeProperty"==h.attributeType?t[h.role]={bindComponent:"",bindInterface:"",operator:j.comparator,value:j.valueAssessment.value,variable:ContextPlayer.isVariable(j.valueAssessment.value)}:console.warn("Eventos de tipos diferentes de attribution nao foram implementados para elementos do tipo AttributeAssessment"))}for(p in t)k.push(t[p]);for(d in m){var j=m[d],h=!1,e="",q=!1;"onSelection"===j.role&&j.key&&(ContextPlayer.isVariable(j.key)&&(h=!0),e=j.key,q=!0);g[j.role]={bindComponent:"",bindInterface:null,
eventType:this.eventType[j.role],flag:!1,keyUseVariable:h,keyDefaultValue:e,useKey:q}}m=l.simpleAction;l.compoundAction&&(r=l.compoundAction[0].operator.toLowerCase(),m=l.compoundAction[0].simpleAction);for(d in m)j=m[d],"set"==j.role?(l=!1,h="",j.value&&(ContextPlayer.isVariable(j.value)&&(l=!0),h=j.value),f[j.role]={binds:[],qualifier:m[d].qualifier,actionUseVariable:l,actionDefaultValue:h,pendingAcks:0}):f[j.role]={binds:[],qualifier:m[d].qualifier};l=[this];r=new Listener(n,r,f,g,k,this.presentation,
l);if(a.linkParam)for(d in a.linkParam)currentLinkParam=a.linkParam[d],s["$"+currentLinkParam.name]=currentLinkParam.value;for(d in a.bind)if(k=a.bind[d],q=k.component.id,n="#"+this.presentation.getDivId(q),m=k["interface"],f[k.role])h=null,j=f[k.role],"set"==k.role&&(j.actionUseVariable?(o=ContextPlayer.createLocalParamMap(k.bindParam),h=o[j.actionDefaultValue]?o[j.actionDefaultValue]:s[j.actionDefaultValue]):h=j.actionDefaultValue),this.context[q]&&m&&l.push(this.context[q]),j.binds.push({bindComponent:n,
bindInterface:m,value:h});else if(g[k.role]){e=g[k.role];e.bindComponent=n;e.bindInterface=m;var j=n,h=this.eventType[k.role],n=k.role,h=[h,n].join("."),q=[q,h].join("."),u=h+".triggerArray";if(e.useKey){var o=ContextPlayer.createLocalParamMap(k.bindParam);e.keyDefaultValue=o[e.keyDefaultValue]||s[e.keyDefaultValue];o=e.keyDefaultValue;$.isNumeric(o)&&(o="KEY_"+o);o in this.presentation.keys&&(e.keyDefaultValue=this.presentation.keys[o]);o="undefined";e=j;if("context"==k.component._type&&m){for(d in k.component.port)if(e=
k.component.port[d],portId=k.component.port[d].id,portId==m){o=e;break}e="#"+this.presentation.getDivId(o.component.id)}this.presentation.keyEvents[e]=!1}c[q]||(c[q]=!0,$(j).data(u)||$(j).data(u,[]),$(j).data(h)||$(j).data(h,[]),$(j).on(h,{componentDivId:j,bindName:h,eventName:n,triggerArrayName:u},function(a,b,c){var d=$(a.data.componentDivId).data(a.data.bindName),e;for(e in d){var f=d[e],g=f.flagMap[a.data.eventName];b==g.bindInterface&&("selection"==a.type&&g.useKey?g.useKey&&a.which&&g.keyDefaultValue==
a.which&&f.notifyEvent(a.data.eventName):f.notifyEvent(a.data.eventName))}ContextPlayer.executeTriggerArray($(a.data.componentDivId).data(a.data.triggerArrayName));c&&c()}));r.triggerBuffer=$(j).data(u);$(j).data(h).push(r)}else currentAssessment=t[k.role],currentAssessment.bindComponent=n,currentAssessment.bindInterface=m,currentAssessment.variable&&(o=ContextPlayer.createLocalParamMap(k.bindParam),currentAssessment.value=o[currentAssessment.value]?o[currentAssessment.value]:s[currentAssessment.value])}};function FlowPlayer(a){this.p=a;this.htmlPlayer="#"+a.id;this.flowPlayer=void 0;a.createElement("<div class='player' id='"+a.id+"'></div>")}Html5Player.prototype.unload=function(){$(this.htmlPlayer).empty()};
FlowPlayer.prototype.load=function(a){console.log(this.p);this.flowPlayer=$f(this.p.id,"http://releases.flowplayer.org/swf/flowplayer-3.2.12.swf",{clip:{autoPlay:!1,autoBuffering:!0,url:a,scaling:"scale"},play:{replayLabel:null,label:null,opacity:0},canvas:{background:"#000000",backgroundGradient:"none"},plugins:{controls:null}})};FlowPlayer.prototype.exec=function(a,b){if("begin"==a)this.flowPlayer.onStart(b);else if("end"==a)this.flowPlayer.onFinish(b);else this.flowPlayer.onCuepoint(a,b)};
FlowPlayer.prototype.start=function(){this.flowPlayer.play();console.log(this.flowPlayer)};FlowPlayer.prototype.stop=function(){this.flowPlayer.stop()};FlowPlayer.prototype.pause=function(){this.flowPlayer.pause()};FlowPlayer.prototype.resume=function(){this.flowPlayer.resume()};FlowPlayer.prototype.abort=function(){this.stop()};FlowPlayer.prototype.seek=function(a){this.flowPlayer.seek(a);this.flowPlayer.pause()};FlowPlayer.prototype.seekAndPlay=function(a){this.flowPlayer.seek(a);this.flowPlayer.resume()};function Html5Player(a){this.p=a;this.popcornPlayer=void 0;this.htmlPlayer="#"+a.id;this.durationBind=this.duration=void 0;this.durationBinded=!1;this.durationMap={};this.endCallbacks=[];a.onChangeProperty.propertyMap={soundLevel:Player.propertyAction.OVERLOAD,fit:Player.propertyAction.OVERLOAD};switch(a.source.type.split("/")[0]){case "video":a.createElement("<video class='player' poster='images/loading.gif' id='"+a.id+"'></video>");break;case "audio":a.createElement("<audio class='player' id='"+
a.id+"'></audio>");break;case "image":a.createElement("<img class='player' id='"+a.id+"'></img>");break;case "application":switch(a.source.type){case "application/x-ginga-settings":a.createElement("<div class='player' id='"+a.id+"'></div>");break;case "application/x-ginga-NCLua":Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,"media",[a.source.type]);break;case "application/x-ginga-NCLet":Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,"media",[a.source.type]);break;case "application/x-ginga-time":Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,
"media",[a.source.type])}break;case "text":switch(a.source.type){case "text/plain":case "text/html":a.createElement("<div class='player' id='"+a.id+"'></div>");break;case "text/css":Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,"media",[a.source.type]);break;case "text/xml":Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,"media",[a.source.type])}}if(a.checkType(["video","audio"])){do this.popcornPlayer=new Popcorn(this.htmlPlayer);while(!this.popcornPlayer)}else if(a.checkType(["image","text"])){do Popcorn.player("baseplayer"),
this.popcornPlayer=new Popcorn.baseplayer(this.htmlPlayer);while(!this.popcornPlayer)}this.playing=!1;this.playingArea=void 0;this.anchors=[];for(i in a.area){var b=a.area[i].id;this.anchors[b]=a.area[i];this.anchors[b].temporal=a.area[i].begin||a.area[i].end||a.area[i].first||a.area[i].last?!0:!1;this.anchors[b].textual=a.area[i].beginText||a.area[i].endText||a.area[i].beginPosition||a.area[i].endPosition?!0:!1;this.anchors[b].spatial=a.area[i].coords?!0:!1;this.anchors[b].temporal&&(eval("this.exec(this.anchors[id].beginTime,$.proxy(function() {$(this.htmlPlayer).trigger('presentation.onBegin',['"+
b+"']);},this));"),eval("this.exec(this.anchors[id].endTime,$.proxy(function() {this.stopArea('"+b+"');},this));"));if(this.anchors[b].spatial&&!this.anchors[b]._ignore){var c=this.anchors[b].coords.split(",");for(i in c){var d=c[i].split("%");1<d.length&&(c[i]='Math.round(parseInt($(this.htmlPlayer).css("'+(i%2?"height":"width")+'").split("px")[0]) * '+parseFloat(d[0])/100+")")}this.anchors[b].calculatedCoords=c;this.p.checkType(["image"])||Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,"area",["coords",
a.source.type])}}this.exec("end",$.proxy(function(){for(i in this.anchors)this.anchors[i].temporal&&this.stopArea(i)},this))}Html5Player.prototype.stopArea=function(a){this.anchors[a].started?(this.anchors[a].started=!1,$(this.htmlPlayer).trigger("stop",[a])):$(this.htmlPlayer).trigger("presentation.onEnd",[a])};Html5Player.prototype.unload=function(){$(this.htmlPlayer).empty()};
Html5Player.prototype.load=function(a){var b=a.substr(0,a.lastIndexOf("."));switch(this.p.source.type.split("/")[0]){case "video":$(this.htmlPlayer).append("<source type='video/webm' src='"+b+".webm'></source>");$(this.htmlPlayer).append("<source type='video/ogg' src='"+b+".ogg'></source>");$(this.htmlPlayer).append("<source type='video/mp4' src='"+b+".mp4'></source>");break;case "audio":$(this.htmlPlayer).append("<source type='audio/mpeg' src='"+b+".mp3'></source>");$(this.htmlPlayer).append("<source type='audio/ogg' src='"+
b+".ogg'></source>");break;case "image":$(this.htmlPlayer).attr("src",a);break;case "text":this.p.checkType(["text/plain","text/html"])&&$.ajax({type:"GET",url:a,dataType:"text",success:$.proxy(function(a){this.textData=a;this.loadTextData()},this)})}};Html5Player.prototype.exec=function(a,b){if(this.popcornPlayer)if("begin"==a)$(this.htmlPlayer).on("play",b);else"end"==a?(this.endCallbacks.push(b),$(this.htmlPlayer).on("ended",b)):this.popcornPlayer.cue(a,b)};
Html5Player.prototype.start=function(a){var b=!1;this.playingArea&&(this.anchors[this.playingArea].started=!1);if(a){if(this.anchors[a].temporal){this.anchors[a].started=!0;this.playingArea=a;var c=this.anchors[a].beginTime;"begin"!=c&&!(c>this.getDuration())?this.seekAndPlay(c):("begin"!=c&&Logger.warning(Logger.WARN_INVALID_AREA,"area",["begin","end"]),this.playing&&(this.seek(0),b=!0))}this.anchors[a].textual&&this.p.checkType(["text"])&&(this.textualAnchor=this.anchors[a],this.textData&&this.loadTextData());
this.anchors[a].spatial&&!this.anchors[a]._ignore&&this.p.checkType(["image"])&&(c="rect("+eval(this.anchors[a].calculatedCoords[1])+"px,"+eval(this.anchors[a].calculatedCoords[2])+"px,"+eval(this.anchors[a].calculatedCoords[3])+"px,"+eval(this.anchors[a].calculatedCoords[0])+"px)",$(this.htmlPlayer).css("clip",c))}else this.playingArea=void 0,this.playing&&(b=!0);if((!a||!this.anchors[a].textual)&&this.p.checkType(["text"]))this.textualAnchor=void 0;(!a||!this.anchors[a].spatial)&&this.p.checkType(["image"])&&
$(this.htmlPlayer).css("clip","auto");!b&&this.popcornPlayer&&(this.popcornPlayer.play(),this.durationBind&&!this.durationBinded&&this.p.checkType(["image","text"])&&eval(this.durationBind))};Html5Player.prototype.stop=function(){this.playing=!1;this.popcornPlayer&&this.popcornPlayer.pause(0);this.p.checkType(["image","text"])&&(this.durationBinded=!1);$(this.htmlPlayer).css("clip","auto")};Html5Player.prototype.pause=function(){this.playing=!1;this.popcornPlayer&&this.popcornPlayer.pause()};
Html5Player.prototype.resume=function(){this.playing=!0;this.popcornPlayer&&this.popcornPlayer.play()};Html5Player.prototype.abort=function(){this.stop()};Html5Player.prototype.seek=function(a){if(this.popcornPlayer)try{this.popcornPlayer.currentTime(a)}catch(b){eval("$(this.htmlPlayer).one('loadedmetadata',$.proxy(function() {this.popcornPlayer.currentTime("+a+");},this));")}};
Html5Player.prototype.seekAndPlay=function(a){if(this.p.checkType(["video","audio"])){try{this.popcornPlayer.currentTime(a)}catch(b){eval("$(this.htmlPlayer).one('loadedmetadata',$.proxy(function() {this.popcornPlayer.currentTime("+a+");},this));")}$(this.htmlPlayer).one("seeked",$.proxy(function(){this.popcornPlayer.play()},this))}else this.p.checkType(["image","text"])&&this.popcornPlayer.currentTime(a)};Html5Player.prototype.stopCallback=function(a){if(this.duration==a)for(var b in this.endCallbacks)this.endCallbacks[b]()};
Html5Player.prototype.setProperty=function(a,b){switch(a){case "explicitDur":this.duration=b;this.durationMap[b]||(this.durationMap[b]=!0,this.durationBind="this.exec("+b+",$.proxy(function() {this.stopCallback("+b+");},this));",eval(this.durationBind),this.durationBinded=!0);break;case "soundLevel":this.p.checkType(["video","audio"])&&this.popcornPlayer.volume(b);break;case "fontColor":$(this.htmlPlayer).css("color",b);break;case "fontFamily":$(this.htmlPlayer).css("font-family",b);break;case "fontStyle":$(this.htmlPlayer).css("font-style",
b);break;case "fontSize":$(this.htmlPlayer).css("font-size",b);break;case "fontVariant":$(this.htmlPlayer).css("font-variant",b);break;case "fontWeight":$(this.htmlPlayer).css("font-weight",b);break;case "style":Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,"setProperty",[a]);break;case "fit":"meetBest"==b&&Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,"setProperty",[a]),console.log("Property 'fit' works only on Opera 10.6+"),$(this.htmlPlayer).css("-o-object-fit",{fill:"fill",hidden:"none",meet:"contain",
meetBest:"scaleDown",slice:"cover"}[b])}};Html5Player.prototype.getDuration=function(){return this.duration&&this.popcornPlayer.duration?Math.min(this.duration,this.popcornPlayer.duration()):this.duration||this.popcornPlayer.duration()};
Html5Player.prototype.loadTextData=function(){var a="",b="",c="",d="";this.textualAnchor&&(a=this.textualAnchor.beginText||"",b=this.textualAnchor.endText||"",c=this.textualAnchor.beginPosition||1,d=this.textualAnchor.endPosition||1);var e=this.textData;if(a){var f=e,e=e.split(a);e.length>c?e=a+e.slice(c).join(a):(e=f,Logger.warning(Logger.WARN_INVALID_AREA,"area",["beginText","beginPosition"]))}b&&(a=e,e=e.split(b),d-=this.textData.split(b).length-e.length,e.length>d&&0<d?e=e.slice(0,d).join(b)+
b:(e=a,Logger.warning(Logger.WARN_INVALID_AREA,"area",["endText","endPosition"])));e&&$(this.htmlPlayer).append(e.replace(/\n/g,"<br/>"))};function LuaPlayer(a){console.log("constructor lua: "+a.id);this.p=a;this.htmlPlayer="#"+a.id;this.luajscode=void 0;this.persitent=new libPersistent(!1);this.canvas_objects=[];this.events=new libEvents(this);this.id=0;this.arrayUsers=[];this.isHandlingEvent=!1;a.createElement("<div class='player' id='"+a.id+"'></div>");this.p.onChangeProperty={};this.p.onChangeProperty.defaultAction=Player.propertyAction.OVERRIDE;this.p.onChangeProperty.propertyMap={};this.p.onChangeProperty.propertyMap.width=Player.propertyAction.IGNORE;
this.p.onChangeProperty.propertyMap.height=Player.propertyAction.IGNORE;this.p.onChangeProperty.propertyMap.left=Player.propertyAction.IGNORE;this.p.onChangeProperty.propertyMap.top=Player.propertyAction.IGNORE;a.enableKeyEvents();console.log(a.id)}LuaPlayer.prototype.unload=function(){$(this.htmlPlayer).empty()};
LuaPlayer.prototype.load=function(a){$.ajax({type:"GET",url:a,dataType:"text",async:!1,success:$.proxy(function(a){this.luajscode=lua_load("canvas = libCanvas.init();\n"+a)},this),error:function(){console.log("error to load file")}});this.bindlibs()};LuaPlayer.prototype.exec=function(a){console.log("exec lua: "+a)};
LuaPlayer.prototype.start=function(){console.log("start lua");var a=lua_newtable();a.str["class"]="ncl";a.str.type="presentation";a.str.action="start";this.eventQueue(a,!0);lua_call(this.luajscode);this.events.handlers&&this.callHandlers()};LuaPlayer.prototype.stop=function(){console.log("stop lua");if(this.events.handlers){var a=lua_newtable();a.str["class"]="ncl";a.str.type="presentation";a.str.action="stop";this.eventQueue(a)}};
LuaPlayer.prototype.pause=function(){console.log("pause lua");if(this.events.handlers){var a=lua_newtable();a.str["class"]="ncl";a.str.type="presentation";a.str.action="pause";this.eventQueue(a)}};LuaPlayer.prototype.resume=function(){console.log("resume lua");if(this.events.handlers){var a=lua_newtable();a.str["class"]="ncl";a.str.type="presentation";a.str.action="resume";this.eventQueue(a)}};
LuaPlayer.prototype.abort=function(){console.log("abort lua");if(this.events.handlers){var a=lua_newtable();a.str["class"]="ncl";a.str.type="presentation";a.str.action="abort";this.eventQueue(a)}};LuaPlayer.prototype.seek=function(){console.log("seek lua");this.eventQueue(evt)};LuaPlayer.prototype.seekAndPlay=function(){console.log("seek and play lua")};
LuaPlayer.prototype.keyEventHandler=function(a){if(this.events.handlers){var b=lua_newtable();b.str["class"]="key";b.str.type=a.type;b.str.key=a.key;this.eventQueue(b)}};LuaPlayer.prototype.setProperty=function(a,b){if(this.events.handlers){var c=lua_newtable();c.str["class"]="ncl";c.str.type="attribution";c.str.action="start";c.str.name=a;c.str.value=b;this.eventQueue(c)}};LuaPlayer.prototype.createCanvasObject=function(){};
LuaPlayer.prototype.bindlibs=function(){lua_libs.libCanvas={variable:{id:this.id,p:this.p,canvas_objects:this.canvas_objects}};lua_libs.libCanvas.init=$.proxy(function(){var a=document.createElement("canvas");a.id="mycanvas_"+this.variable.id;a.width=500;a.height=500;$("#"+this.variable.p.id).append(a);a=a.getContext("2d");a=new libCanvas(a);console.log("init");this.variable.canvas_objects[this.variable.id]=a;a=lua_newtable();a.str.id=this.variable.id;a.str["new"]=$.proxy(function(a,c,d){void 0===
d?(objCanvas=this.variable.canvas_objects[a.str.id],newObject=objCanvas.newImage(c),this.variable.id+=1,this.variable.canvas_objects[this.variable.id]=newObject,a=$.extend(!0,{},a),a.str.id=this.variable.id):(objCanvas=this.variable.canvas_objects[a.str.id],newObject=objCanvas.newCanvas(c,d),this.variable.id+=1,a=$.extend(!0,{},a),a.str.id=this.variable.id,this.variable.canvas_objects[this.variable.id]=newObject);return[a]},this);a.str.attrSize=$.proxy(function(a){return this.variable.canvas_objects[a.str.id].attrSize()},
this);a.str.attrColor=$.proxy(function(a,c,d,e,f){this.variable.canvas_objects[a.str.id].attrColor(c,d,e,f)},this);a.str.drawLine=$.proxy(function(a,c,d,e,f){this.variable.canvas_objects[a.str.id].drawLine(c,d,e,f)},this);a.str.drawRect=$.proxy(function(a,c,d,e,f,g){this.variable.canvas_objects[a.str.id].drawRect(c,d,e,f,g)},this);a.str.drawText=$.proxy(function(a,c,d,e){this.variable.canvas_objects[a.str.id].drawText(c,d,e)},this);a.str.measureText=$.proxy(function(a,c){return this.variable.canvas_objects[a.str.id].measureTextLua(c)},
this);a.str.attrText=$.proxy(function(a){this.variable.canvas_objects[a.str.id].attrText(face,size,style)},this);a.str.compose=$.proxy(function(a,c,d,e){this.variable.canvas_objects[a.str.id].compose(c,d,this.variable.canvas_objects[e.str.id])},this);a.str.attrCrop=$.proxy(function(a,c,d,e,f){return[this.variable.canvas_objects[a.str.id].attrCrop(c,d,e,f)]},this);a.str.attrClip=$.proxy(function(a,c,d,e,f){this.variable.canvas_objects[a.str.id].attrClip(c,d,e,f)},this);return[a]},lua_libs.libCanvas);
persist=this.persitent;lua_libs.persistent={set:function(a,b,c){persist.storeField(a,b,c)},get:function(a){return[persist.recoverField(a)]}};events=this.events;lua_libs.event={post:function(a){events.post(a)},register:function(a){events.register(a)},unregister:function(a){events.unregister(a)},timer:function(a,b){events.timer(a,b)},uptime:function(){return events.uptime()}}};
LuaPlayer.prototype.callHandlers=function(){if(!this.isHandlingEvent){this.isHandlingEvent=!0;for(var a=this.arrayUsers.splice(0,1);1<=a.length;){for(i=0;i<this.events.handlers.length;i++)void 0!==this.events.handlers[i]&&setTimeout($.proxy(function(){this.handler(this.evnt)},{handler:this.events.handlers[i],evnt:a[0]}),0);a=this.arrayUsers.splice(0,1)}this.isHandlingEvent=!1}};LuaPlayer.prototype.eventQueue=function(a,b){this.arrayUsers.push(a);void 0==b&&this.callHandlers()};MediaPlayer.prototype=new Player;function MediaPlayer(a,b){this.htmlPlayerBkg=this.type=this.region="";this.playerSettings=this.playerName=this.player=void 0;this.transIn=[];this.transOut=[];this.isVisible=!0;this.userKeyEvents=this.isFocused=!1;this.explicitDur=void 0;this.opacity=1;this.node=a;this.presentation=b.presentation;this.parentContext=b;this.divId=this.presentation.getDivId(a.id);this.create(a)}
MediaPlayer.prototype.colorValues={white:"255,255,255",black:"0,0,0",silver:"192,192,192",gray:"128,128,128",red:"255,0,0",maroon:"128,0,0",fuchsia:"255,0,255",purple:"128,0,128",lime:"0,255,0",green:"0,128,0",yellow:"255,255,0",olive:"128,128,0",blue:"0,0,255",navy:"0,0,128",aqua:"0,255,255",teal:"0,128,128"};
MediaPlayer.prototype.mediaTypes={htm:"text/htm",html:"text/html",txt:"text/plain",css:"text/css",xml:"text/xml",bmp:"image",png:"image",gif:"image",jpg:"image",jpeg:"image",wav:"audio",mp3:"audio",mp2:"audio",mp4:"video",mpg4:"video",mpeg:"video",mpg:"video",webm:"video",ogg:"audio",ogv:"video",flv:"video/x-flv",lua:"application/x-ginga-NCLua","class":"application/x-ginga-NCLet",jar:"application/x-ginga-NCLet"};
MediaPlayer.prototype.checkType=function(a){var b=this.type.split("/"),c;for(c in a){var d=a[c].split("/");if(d[0]==b[0]&&(!d[1]||b[1]&&d[1]==b[1]))return!0}return!1};MediaPlayer.prototype.createElement=function(a){$(this.htmlPlayerBkg).append(a)};
MediaPlayer.prototype.enableKeyEvents=function(a){void 0===a||a?(a=!1,this.isPlaying&&(a=!0),this.presentation.keyEvents[this.htmlPlayer]=a,this.userKeyEvents||(this.userKeyEvents=!0,$(this.htmlPlayer).on("selection.onSelection.user",{mplayer:this},function(a){if(a.which){var c=a.data.mplayer;c.player.keyEventHandler({"class":"key",type:"press",key:c.presentation.reverseKeys[a.which]})}}))):(delete this.presentation.keyEvents[this.htmlPlayer],$(this.htmlPlayer).off("selection.onSelection.user"),this.userKeyEvents=
!1)};
MediaPlayer.prototype.create=function(a){a.descriptor&&(this.transIn=a.descriptor.transIn,this.transOut=a.descriptor.transOut,this.explicitDur=a.descriptor.explicitDur);if(a.type)this.type=a.type;else{var b=a.src.split(".");this.type=this.mediaTypes[b[b.length-1]]}this.htmlPlayer="#"+this.divId;this.htmlPlayerBkg="#"+this.presentation.getDivId(a.id,"bkg");this.region="application/x-ginga-settings"===this.type?"#"+this.presentation.settingsDiv:"#"+this.presentation.playerDiv;"application/x-ginga-settings"==this.type&&
(this.presentation.settingsNode=this);if(!(a.refer&&"new"!=a.instance)){$(this.region).append("<div class='playerBkg' id='"+this.presentation.getDivId(a.id,"bkg")+"'></div>");b=this.presentation.mediaPlayers;if(b[this.type])if(this.playerSettings={source:{type:this.type,ext:a._ext,url:this.presentation.path+a.src},onChangeProperty:{defaultAction:Player.propertyAction.IGNORE,propertyMap:{}},id:this.divId,parentId:this.presentation.getDivId(a.id,"bkg"),createElement:$.proxy(this.createElement,this),
checkType:$.proxy(this.checkType,this),getProperty:$.proxy(this.getProperty,this),setProperty:$.proxy(this.setProperty,this),postEvent:this.presentation.postEvent,enableKeyEvents:$.proxy(this.enableKeyEvents,this),area:a.area},b=b[this.type][a._ext]||b[this.type].defaultPlayer)for(i in this.player=new b(this.playerSettings),this.playerName=b.name,b="load,unload,exec,start,stop,pause,resume,abort,seek,seekAndPlay,setProperty,getDuration,keyEventHandler".split(","),b)this.player[b[i]]||(this.player.__playerName||
(this.player.__playerName=this.playerName),this.player[b[i]]=function(){Logger.error(Logger.ERR_MEDIAPLAYER_METHOD_NOTFOUND,this.__playerName,[arguments.callee.name])});else Logger.error(Logger.ERR_MEDIAPLAYER_NOPLAYER,this.type,["no defaultPlayer or extension player"]),this.player={};else Logger.error(Logger.ERR_MEDIAPLAYER_NOPLAYER,this.type),this.player={};$(this.htmlPlayerBkg).css("display","none");this.load(a.src);this.data=$(this.htmlPlayer).data();this.player.exec&&this.player.exec("end",$.proxy(function(){this.playingArea?
($(this.htmlPlayer).trigger("presentation.onEnd"),this.playingArea=void 0):this.stop()},this));$(this.htmlPlayer).data("property",[]);if(a.descriptor)for(i in a.descriptor.explicitDur&&this.setProperty("explicitDur",a.descriptor.explicitDur),a.descriptor.region&&(this.setProperty("zIndex",a.descriptor.region.zIndex),this.setProperty("width",a.descriptor.region.width),this.setProperty("height",a.descriptor.region.height),this.setProperty("bottom",a.descriptor.region.bottom),this.setProperty("top",
a.descriptor.region.top),this.setProperty("right",a.descriptor.region.right),this.setProperty("left",a.descriptor.region.left),this.setProperty("title",a.descriptor.region.title)),a.descriptor.descriptorParam)this.setProperty(a.descriptor.descriptorParam[i].name,a.descriptor.descriptorParam[i].value);b=[];for(i in a.property)if(a.property[i].value)switch(a.property[i].name){case "bounds":case "top":case "left":case "bottom":case "right":case "height":case "width":b.push({name:a.property[i].name,value:a.property[i].value});
break;default:this.setProperty(a.property[i].name,a.property[i].value)}if(0<b.length){var a={left:0,top:0,width:parseInt($("#"+this.presentation.playerDiv).css("width").split("px")[0]),height:parseInt($("#"+this.presentation.playerDiv).css("height").split("px")[0])},c={left:null,right:null,top:null,bottom:null,width:null,height:null};this.node.descriptor&&this.node.descriptor.region&&(a.left=this.node.descriptor.region._parent.left?parseInt(this.node.descriptor.region._parent.left.split("px")[0]):
0,a.top=this.node.descriptor.region._parent.top?parseInt(this.node.descriptor.region._parent.top.split("px")[0]):0,a.width=this.node.descriptor.region._parent.width?parseInt(this.node.descriptor.region._parent.width.split("px")[0]):parseInt($("#"+this.presentation.playerDiv).css("width").split("px")[0]),a.height=this.node.descriptor.region._parent.height?parseInt(this.node.descriptor.region._parent.height.split("px")[0]):parseInt($("#"+this.presentation.playerDiv).css("height").split("px")[0]),c.left=
(this.node.descriptor.region.left.split("px")[0]-a.left).toString(),c.top=(this.node.descriptor.region.top.split("px")[0]-a.top).toString(),c.width=this.node.descriptor.region.width,c.height=this.node.descriptor.region.height);for(i in b){var d=b[i].name,e=b[i].value;switch(d){case "bounds":e=e.split(",");c.left=e[0];c.top=e[1];c.width=e[2];c.height=e[3];break;case "top":case "left":case "bottom":case "right":case "height":case "width":c[d]=e}}WebNclPlayer.prototype.fixRegionBounds(c,a);for(d in c)(e=
c[d])&&null!=e&&this.setProperty(d,e)}this.player.exec("end",$.proxy(function(){this.playingArea?($(this.htmlPlayer).trigger("presentation.onEnd"),this.playingArea=void 0):this.stop()},this));this.bindEvents();$(this.htmlPlayer).data("player",this)}};MediaPlayer.prototype.load=function(a){a=this.presentation.path+a;this.player.unload(a);this.player.load(a)};
MediaPlayer.prototype.focus=function(){if(!this.isFocused&&(this.isFocused=!0,this.node.descriptor)){var a=parseInt(this.node.descriptor.focusBorderWidth||this.presentation.systemSettings.getPropertyValue("default.focusBorderWidth"));if(0<a){var b=this.node.descriptor.focusBorderColor||this.presentation.systemSettings.getPropertyValue("default.focusBorderColor"),c=1-parseInt(this.node.descriptor.focusBorderTransparency||0),b=a+"px solid rgba("+this.colorValues[b]+","+c+")";$(this.htmlPlayerBkg).css("left",
"-="+a);$(this.htmlPlayerBkg).css("top","-="+a);$(this.htmlPlayerBkg).css("border",b)}else 0>a&&Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,"border",[a]);this.node.descriptor.focusSrc&&this.load(this.node.descriptor.focusSrc)}};
MediaPlayer.prototype.blur=function(){this.isFocused=!1;$(this.htmlPlayerBkg).css("left",$(this.htmlPlayer).data("property").left);$(this.htmlPlayerBkg).css("top",$(this.htmlPlayer).data("property").top);$(this.htmlPlayerBkg).css("width",$(this.htmlPlayer).data("property").width);$(this.htmlPlayerBkg).css("height",$(this.htmlPlayer).data("property").height);$(this.htmlPlayerBkg).css("border","none");this.node.descriptor.focusSrc&&this.load(this.node.src)};
MediaPlayer.prototype.selection=function(){if(this.node.descriptor){var a;a=this.node.descriptor.selBorderColor||this.presentation.systemSettings.getPropertyValue("default.selBorderColor");$(this.htmlPlayer).css("border-color",a);a="var p=$('"+this.htmlPlayer+"').data('player'); if (p.isFocused) p.focus(); else p.blur();";this.node.descriptor.focusSelSrc&&(this.load(this.node.descriptor.focusSelSrc),this.node.descriptor.focusSrc||(a+="$('"+this.htmlPlayer+"').data('player').load('"+this.node.src+
"');"));setTimeout(a,200)}};
MediaPlayer.prototype.applyTransition=function(a,b){var c=a.dur?1E3*parseFloat(a.dur.split("s")[0]):1E3,d={},e={},f="";switch(a.type){case "fade":a.subtype=a.subtype||"crossfade";f=this.htmlPlayer;d.opacity=a.startProgress||0;e.opacity=a.endProgress||1;if("fadeToColor"==a.subtype||"fadeFromColor"==a.subtype)$(this.htmlPlayerBkg).css("background-color",a.fadeColor||"black"),b="fadeToColor"==a.subtype?"out":"in";if("out"==b){var g=d.opacity;d.opacity=e.opacity;e.opacity=g}this.opacity=e.opacity;break;
case "barWipe":a.subtype=a.subtype||"leftToRight";f=this.htmlPlayerBkg;g=1==("reverse"==a.direction?1:0)+("out"==b?1:0);switch(a.subtype){case "leftToRight":d.width="0px";e.width=$(this.htmlPlayer).css("width");g&&(d.left=parseInt($(this.htmlPlayer).css("left").split("px")[0])+parseInt($(this.htmlPlayer).css("width").split("px")[0])+"px",e.left=$(this.htmlPlayer).css("left"));break;case "topToBottom":d.height="0px",e.height=$(this.htmlPlayer).css("height"),g&&(d.top=parseInt($(this.htmlPlayer).css("top").split("px")[0])+
parseInt($(this.htmlPlayer).css("height").split("px")[0])+"px",e.top=$(this.htmlPlayer).css("top"))}if("out"==b)for(i in d)g=d[i],d[i]=e[i],e[i]=g;break;case "irisWipe":a.subtype=a.subtype||"rectangle";f=this.htmlPlayerBkg;if("rectangle"==a.subtype){var g=parseInt($(this.htmlPlayer).css("left").split("px")[0]),p=parseInt($(this.htmlPlayer).css("top").split("px")[0]),h=parseInt($(this.htmlPlayer).css("width").split("px")[0]),n=parseInt($(this.htmlPlayer).css("height").split("px")[0]);d.width="0px";
d.height="0px";d.left=g+h/2+"px";d.top=p+n/2+"px";e.width=h+"px";e.height=n+"px";e.left=g+"px";e.top=p+"px";if("out"==b)for(i in d)g=d[i],d[i]=e[i],e[i]=g}else Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,"transition",[a.type,a.subtype]);break;case "snakeWipe":case "clockWipe":Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,"transition",[a.type])}$(f).css(d);$(f).animate(e,c);$(f).dequeue()};
MediaPlayer.prototype.show=function(){if(this.isVisible){this.transIn&&this.transIn._type&&(this.transIn=[this.transIn]);this.transOut&&this.transOut._type&&(this.transOut=[this.transOut]);for(i in this.transIn)this.applyTransition(this.transIn[i],"in");$(this.htmlPlayerBkg).css("display","inline");$(this.htmlPlayer).css("opacity",this.opacity)}};MediaPlayer.prototype.hide=function(){for(i in this.transOut)this.applyTransition(this.transOut[i],"out");$(this.htmlPlayerBkg).css("display","none")};
MediaPlayer.prototype.start=function(a){if("Html5Player"==this.playerName&&this.player.p.checkType(["video"]))if(this.ready)a=this.nodeInterface,this.ready=!1;else if(1>this.player.popcornPlayer.readyState()){this.nodeInterface=a;this.ready=!0;this.player.popcornPlayer.on("loadedmetadata",$.proxy(function(){this.start()},this));return}this.player.start(a);this.isStopped&&(this.presentation.inputManager.enableKeys(this.htmlPlayer),this.node.descriptor&&this.presentation.inputManager.addMedia(this.node.descriptor.focusIndex,
this.htmlPlayer),this.isPlaying=!0,this.isStopped=!1,this.show());this.trigger("presentation.onBegin",[a])};MediaPlayer.prototype.stop=function(a){this.isStopped||(this.presentation.inputManager.disableKeys(this.htmlPlayer),this.node.descriptor&&this.presentation.inputManager.removeMedia(this.node.descriptor.focusIndex,this.htmlPlayer),this.isPlaying=!1,this.isStopped=!0,this.hide(),this.player.stop(),this.trigger("presentation.onEnd",[a]))};
MediaPlayer.prototype.pause=function(a){this.isPlaying&&(this.isStopped=this.isPlaying=!1,this.presentation.inputManager.disableKeys(this.htmlPlayer),this.player.pause(),this.trigger("presentation.onPause",[a]))};MediaPlayer.prototype.resume=function(a){!this.isStopped&&!this.isPlaying&&(this.isPlaying=!0,this.isStopped=!1,this.presentation.inputManager.enableKeys(this.htmlPlayer),this.player.resume(),this.trigger("presentation.onResume",[a]))};
MediaPlayer.prototype.abort=function(a){this.isStopped||(this.presentation.inputManager.disableKeys(this.htmlPlayer),this.node.descriptor&&this.presentation.inputManager.removeMedia(this.node.descriptor.focusIndex,this.htmlPlayer),this.isPlaying=!1,this.isStopped=!0,this.hide(),this.player.abort(),this.trigger("presentation.onAbort",[a]))};MediaPlayer.prototype.seek=function(a){this.player.seek(a)};MediaPlayer.prototype.seekAndPlay=function(a){this.player.seekAndPlay(a)};function Player(){this.create=function(){};this.start=function(){};this.stop=function(){};this.pause=function(){};this.resume=function(){};this.abort=function(){};this.seekAndPlay=function(){};this.selection=function(){};this.data=void 0;this.htmlPlayer="";this.isPlaying=!1;this.isStopped=!0}Player.propertyAction={IGNORE:0,OVERRIDE:1,OVERLOAD:2};
Player.prototype.trigger=function(a,b){var c;switch(a){case "presentation.onBegin":case "presentation.onResume":this.parentContext.playingElem.push(this);c=$.inArray(this,this.parentContext.pausedElem);-1<c&&this.parentContext.pausedElem.splice(c-1,1);break;case "presentation.onPause":this.parentContext.pausedElem.push(this);c=$.inArray(this,this.parentContext.playingElem);-1<c&&this.parentContext.playingElem.splice(c-1,1);break;case "presentation.onEnd":case "presentation.onAbort":c=$.inArray(this,
this.parentContext.playingElem),-1<c?this.parentContext.playingElem.splice(c-1,1):(c=$.inArray(this,this.parentContext.pausedElem),-1<c&&this.parentContext.pausedElem.splice(c-1,1))}this.parentContext.lastMediaAborted="presentation.onAbort"===a?!0:!1;$(this.htmlPlayer).trigger(a,b);this.parentContext.notifyLink(0)};Player.prototype.__ecallback=function(){this.parentContext.notifyLink(0)};
Player.prototype.bindEvents=function(){$(this.htmlPlayer).on("start",{player:this},function(a,b,c,d){a.originalEvent||(a.data.player.start(b),c&&c(d))});$(this.htmlPlayer).on("stop",{player:this},function(a,b,c,d){a.originalEvent||(a.data.player.stop(b),c&&c(d))});$(this.htmlPlayer).on("pause",{player:this},function(a,b,c,d){a.originalEvent||(a.data.player.pause(b),c&&c(d))});$(this.htmlPlayer).on("resume",{player:this},function(a,b,c,d){a.originalEvent||(a.data.player.resume(b),c&&c(d))});$(this.htmlPlayer).on("abort",
{player:this},function(a,b,c,d){a.originalEvent||(a.data.player.abort(b),c&&c(d))});$(this.htmlPlayer).on("set",{player:this},function(a,b,c,d,e){if(!a.originalEvent){a.stopPropagation();a=a.data.player;switch(b){case "top":case "bottom":case "height":e=a.calculatePercentageValue("height",e);a.setProperty(b,e);break;case "left":case "right":case "width":e=a.calculatePercentageValue("width",e);a.setProperty(b,e);break;case "bounds":b=e.split(",");a.setProperty("left",a.calculatePercentageValue("width",
b[0]));a.setProperty("top",a.calculatePercentageValue("height",b[1]));a.setProperty("width",a.calculatePercentageValue("width",b[2]));a.setProperty("height",a.calculatePercentageValue("height",b[3]));break;default:a.setProperty(b,e)}c&&c(d)}});$(this.htmlPlayer).on("focus",{player:this},function(a){a.data.player.focus()});$(this.htmlPlayer).on("blur",{player:this},function(a){a.data.player.blur()});$(this.htmlPlayer).on("selection.onSelection",{player:this},function(a){a.data.player.selection()})};
Player.prototype.calculatePercentageValue=function(a,b){var c=b.toString().split("%");if(1<c.length)var d=$(this.htmlPlayerBkg).css(a),b=parseInt(parseInt(d)*parseFloat(c[0])/100);return b};Player.prototype.getProperty=function(a){var b=this.presentation.systemSettings.getPropertyValue(a);return b?b:$(this.htmlPlayer).data("property")[a]};
Player.prototype.setProperty=function(a,b,c){c||$(this.htmlPlayer).trigger("attribution.onBeginAttribution",[a]);var d=$(this.htmlPlayer).data("property");d[a]=b?b:"";$(this.htmlPlayer).data("property",d);if(!c){var d=this.playerSettings.onChangeProperty||void 0,e=Player.propertyAction.IGNORE;d&&(e=void 0!=d.propertyMap[a]?d.propertyMap[a]:d.defaultAction)}if(!e||e==Player.propertyAction.OVERLOAD){if(null!=b){switch(a){case "top":case "left":case "bottom":case "right":d=b.toString().split("%");1<
d.length?console.warn("Warning: Percentage position value was passed to 'setProperty' function. The value is being ignored."):("right"==a&&$(this.htmlPlayerBkg).css("left","auto"),"bottom"==a&&$(this.htmlPlayerBkg).css("top","auto"),$(this.htmlPlayerBkg).css(a,b));break;case "height":case "width":d=b.toString().split("%");1<d.length&&(console.warn("Warning: Percentage size value being calculated in 'setProperty' function."),b=$(this.htmlPlayerBkg).css(a),b=parseInt(parseInt(b)*parseFloat(d[0])/100));
$(this.htmlPlayer).css(a,b);$(this.htmlPlayerBkg).css(a,b);break;case "zIndex":$(this.htmlPlayer).css("z-index",b);$(this.htmlPlayerBkg).css("z-index",b);break;case "soundLevel":d=b.split("%");1<d.length&&(b=d[0]/100);break;case "balanceLevel":case "bassLevel":case "trebleLevel":d=b.split("%");1<d.length&&(b=d[0]/100);Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,"setProperty",[a]);break;case "background":$(this.htmlPlayerBkg).css("background-color",b);break;case "transparency":d=b.split("%");b=
1<d.length?parseInt(d[0])/100:parseFloat(d[0]);this.opacity=1-b;$(this.htmlPlayer).css("opacity",this.opacity);break;case "visible":(this.isVisible="true"===b?!0:!1)?(this.node.descriptor&&this.presentation.inputManager.addMedia(this.node.descriptor.focusIndex,this.htmlPlayer),$(this.htmlPlayerBkg).css("display","inline")):(this.node.descriptor&&this.presentation.inputManager.removeMedia(this.node.descriptor.focusIndex,this.htmlPlayer),$(this.htmlPlayerBkg).css("display","none"));break;case "scroll":Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,
"setProperty",[a]);break;case "explicitDur":e||this.player.setProperty(a,b);break;case "baseDeviceRegion":case "deviceClass":case "plan":case "player":case "playerLife":case "reusePlayer":Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,"property",[a]);break;case "transInBorderColor":case "transInBorderWidth":case "transInDirection":case "transInDur":case "transInEndProgress":case "transInFadeColor":case "transInHorRepeat":case "transInStartProgress":case "transInSubtype":case "transInType":case "transInVertRepeat":case "transBorderColor":case "transOutBorderWidth":case "transOutDirection":case "transOutDur":case "transOutEndProgress":case "transOutFadeColor":case "transOutHorRepeat":case "transOutType":case "transOutStartProgress":case "transOutSubtype":case "transOutVertRepeat":Logger.warning(Logger.WARN_NOT_IMPLEMENTED_YET,
"property",[a]);break;case "service.currentFocus":case "default.focusBorderColor":case "default.selBorderColor":case "default.focusBorderWidth":case "default.focusBorderTransparency":this.checkType(["application"])&&this.presentation.systemSettings.setPropertyValue(a,b)}c||(e==Player.propertyAction.OVERLOAD&&this.player.setProperty(a,b),$(this.htmlPlayer).trigger("attribution.onEndAttribution",[a]))}}else c||this.player.setProperty(a,b)};Parser.prototype.parseArea=function(a,b){attrs=["begin","end"];values=["(n\u00famero real)s","HH:MM:SS"];patt1=/^(\d+|\d*\.\d+)s$/;patt2=/^\d+:\d+:\d+(\.\d+)?$/;for(i in attrs){var c=attrs[i];a[c+"Time"]="";if(null!=a[c]){var d=patt1.test(a[c])?1:patt2.test(a[c])?2:0;if(0==d)Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,[c,a[c],values]),a[c+"Time"]=c;else if(1==d)a[c+"Time"]=parseFloat(a[c].split("s")[0]);else{var e=a[c].split(":"),d=parseFloat(e[0]),f=parseFloat(e[1]),e=parseFloat(e[2]);60<=f||60<=
e?(Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,[c,a[c],values]),a[c+"Time"]=c):a[c+"Time"]=3600*parseFloat(d)+60*parseFloat(f)+parseFloat(e)}}else a[c+"Time"]=c}null!=a.begin&&null!=a.end&&a.beginTime>=a.endTime&&(Logger.warning(Logger.WARN_INVALID_AREA,b,["begin","end"]),a.beginTime="begin",a.endTime="end");values=["(n\u00famero inteiro)"];patt=/^\d+$/;null!=a.first&&!patt.test(a.first)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["first",a.first,values]);null!=a.last&&!patt.test(a.last)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,
b,["last",a.last,values]);null!=a.beginPosition&&!patt.test(a.beginPosition)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["beginPosition",a.beginPosition,values]);null!=a.endPosition&&!patt.test(a.endPosition)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["endPosition",a.endPosition,values]);values=["(valor,valor,valor,valor)"];patt1=/^\d+\s*(px)?$/;patt2=/^(\.\d+|(\d|\d\d)(\.\d+)?|100(\.0+)?)%$/;if(a.coords){c=a.coords.split(",");d=!0;if(4==c.length)for(i in c)c[i]=$.trim(c[i]),patt1.test(c[i])?
c[i]=$.trim(c[i].split("px")[0]):patt2.test(c[i])||(d=!1);else d=!1;d?a.coords=c.join(","):(a._ignore=!0,Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["coords",a.coords,values]))}};Parser.prototype.parseAssessmentStatement=function(a,b){values="eq,ne,gt,lt,gte,lte".split(",");null!=a.comparator&&-1==jQuery.inArray(a.comparator,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["comparator",a.comparator,values])};Parser.prototype.parseAttributeAssessment=function(a,b,c,d){null!=a.role&&(c=d.split("causalConnector#")[1].split(">")[0],this.uniqueTable["id#"+c]||(this.uniqueTable["id#"+c]=[]),this.uniqueTable["id#"+c][a.role]?this.uniqueTable["id#"+c][a.role].duplicated||(this.uniqueTable["id#"+c][a.role].duplicated=!0,Logger.error(Logger.ERR_DUPLICATED_ATTR,"role",[a.role,c,["simpleAction","simpleCondition","attributeAssessment"]])):this.uniqueTable["id#"+c][a.role]={duplicated:!1});values=["selection","presentation",
"attribution"];null!=a.eventType&&-1==jQuery.inArray(a.eventType,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["eventType",a.eventType,values]);values="VARIAVEL,0-9,A-Z,*,#,MENU,INFO,GUIDE,CURSOR_DOWN,CURSOR_LEFT,CURSOR_RIGHT,CURSOR_UP,CHANNEL_DOWN,CHANNEL_UP,VOLUME_DOWN,VOLUME_UP,ENTER,RED,GREEN,YELLOW,BLUE,BACK,EXIT,POWER,REWIND,STOP,EJECT,PLAY,RECORD,PAUSE".split(",");patt=/^([0-9A-Z]|\*|\$[A-Za-z_][0-9A-Za-z_]*|#|MENU|INFO|GUIDE|CURSOR_DOWN|CURSOR_LEFT|CURSOR_RIGHT|CURSOR_UP|CHANNEL_DOWN|CHANNEL_UP|VOLUME_DOWN|VOLUME_UP|ENTER|RED|GREEN|YELLOW|BLUE|BACK|EXIT|POWER|REWIND|STOP|EJECT|PLAY|RECORD|PAUSE)$/;
null==a.key?"selection"==a.eventType&&Logger.error(Logger.ERR_MISSING_ATTR,b,["key"]):patt.test(a.key)||Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["key",a.key,values]);switch(a.eventType){case "selection":values=["occurences","state"];break;case "presentation":values=["occurences","state","repetitions"];break;case "attribution":values=["occurences","state","repetitions","nodeProperty"]}null!=a.attributeType&&-1==jQuery.inArray(a.attributeType,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,
b,["attributeType",a.attributeType,values])};Parser.prototype.parseBind=function(){};Parser.prototype.parseBindParam=function(){};Parser.prototype.parseBindRule=function(){};Parser.prototype.parseBody=function(){};Parser.prototype.parseCausalConnector=function(){};Parser.prototype.parseCompositeRule=function(a,b){values=["and","or"];null!=a.operator&&-1==jQuery.inArray(a.operator,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["operator",a.operator,values])};Parser.prototype.parseCompoundAction=function(a,b){values=["par","seq"];null!=a.operator&&-1==jQuery.inArray(a.operator,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["operator",a.operator,values])};Parser.prototype.parseCompoundCondition=function(a,b){values=["and","or"];null!=a.operator&&-1==jQuery.inArray(a.operator,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["operator",a.operator,values]);values=["(n\u00famero real positivo)s"];patt=/^(\d+|\d*\.\d+)s$/;null!=a.delay&&!patt.test(a.delay)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["delay",a.delay,values])};Parser.prototype.parseCompoundStatement=function(a,b){values=["or","and"];null!=a.operator&&-1==jQuery.inArray(a.operator,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["operator",a.operator,values]);values=["true","false"];null!=a.isNegated&&-1==jQuery.inArray(a.isNegated,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["isNegated",a.isNegated,values])};Parser.prototype.parseConnectorBase=function(){};Parser.prototype.parseConnectorParam=function(){};Parser.prototype.parseContext=function(){};Parser.prototype.parseDefaultComponent=function(){};Parser.prototype.parseDefaultDescriptor=function(){};Parser.prototype.parseDescriptorBase=function(){};Parser.prototype.parseDescriptor=function(a,b){values=["(n\u00famero real)s","HH:MM:SS"];patt1=/^(\d+|\d*\.\d+)s$/;patt2=/^\d+:\d+:\d+(\.\d+)?$/;if(null!=a.explicitDur){var c=patt1.test(a.explicitDur)?1:patt2.test(a.explicitDur)?2:0;if(0==c)Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["explicitDur",a.explicitDur,values]);else if(1==c)a.explicitDur=parseFloat(a.explicitDur.split("s")[0]);else{var d=a.explicitDur.split(":"),c=parseFloat(d[0]),e=parseFloat(d[1]),d=parseFloat(d[2]);60<=e||60<=d?Logger.error(Logger.ERR_INVALID_ATTR_VALUE,
b,["explicitDur",a.explicitDur,values]):a.explicitDur=3600*parseFloat(c)+60*parseFloat(e)+parseFloat(d)}}values=["true","false"];null!=a.freeze&&-1==jQuery.inArray(a.freeze,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["freeze",a.freeze,values]);attrs=["focusBorderColor","selBorderColor"];values="white,black,silver,gray,red,maroon,fuchsia,purple,lime,green,yellow,olive,blue,navy,aqua,teal".split(",");for(var f in attrs)attr=attrs[f],value=a[attr],null!=value&&-1==jQuery.inArray(value,values)&&
Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,[attr,value,values]);values=["(n\u00famero inteiro)"];patt=/^-?\d+$/;null!=a.focusBorderWidth&&!patt.test(a.focusBorderWidth)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["focusBorderWidth",a.focusBorderWidth,values]);values=["(n\u00famero real entre 0 e 1)","(n\u00famero real entre 0 e 100)%"];patt=/^((0?\.\d+|1(\.0+)?)|(\d?\d?\.\d+|100(\.0+)?)%)$/;null!=a.focusBorderTransparency&&!patt.test(a.focusBorderTransparency)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,
b,["focusBorderTransparency",a.focusBorderTransparency,values])};Parser.prototype.parseDescriptorParam=function(a,b){if("explicitDur"==a.name){values=["(n\u00famero real)s","HH:MM:SS"];patt1=/^(\d+|\d*\.\d+)s$/;patt2=/^\d+:\d+:\d+(\.\d+)?$/;var c=patt1.test(a.value)?1:patt2.test(a.value)?2:0;if(0==c)Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["value",a.value,values]);else if(1==c)a.value=parseFloat(a.value.split("s")[0]);else{var d=a.value.split(":"),c=parseFloat(d[0]),e=parseFloat(d[1]),d=parseFloat(d[2]);60<=e||60<=d?Logger.error(Logger.ERR_INVALID_ATTR_VALUE,
b,["value",a.value,values]):a.value=3600*parseFloat(c)+60*parseFloat(e)+parseFloat(d)}}};Parser.prototype.parseDescriptorSwitch=function(){};Parser.prototype.parseHead=function(){};Parser.prototype.parseImportBase=function(a){this.uniqueTable.alias||(this.uniqueTable.alias=[]);this.uniqueTable.alias[a.alias]?this.uniqueTable.alias[a.alias].duplicated||(this.uniqueTable.alias[a.alias].duplicated=!0,Logger.error(Logger.ERR_DUPLICATED_ALIAS,"importBase",[a.alias])):this.uniqueTable.alias[a.alias]={duplicated:!1}};Parser.prototype.parseImportedDocumentBase=function(){};Parser.prototype.parseImportNCL=function(a){this.uniqueTable.alias||(this.uniqueTable.alias=[]);this.uniqueTable.alias[a.alias]?this.uniqueTable.alias[a.alias].duplicated||(this.uniqueTable.alias[a.alias].duplicated=!0,Logger.error(Logger.ERR_DUPLICATED_ALIAS,"importNCL",[a.alias])):this.uniqueTable.alias[a.alias]={duplicated:!1}};Parser.prototype.parseLink=function(){};Parser.prototype.parseLinkParam=function(){};Parser.prototype.parseMapping=function(){};Parser.prototype.parseMedia=function(a,b){values=["new","instSame","gradSame"];null!=a.instance&&-1==jQuery.inArray(a.instance,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["instance",a.instance,values]);values="text/html,text/plain,text/css,text/xml,image/bmp,image/png,image/mng,image/gif,image/jpeg,audio/basic,audio/mp3,audio/mp2,audio/mpeg,audio/mpeg4,video/mpeg,video/x-flv,application/x-ginga-NCLua,application/x-ginga-NCLet,application/x-ginga-settings,application/x-ginga-time,applications/x-ginga-NCL,application/x-ncl-NCL,application/x-ncl-NCLua,application/x-ncl-NCLet,application/x-ncl-settings,application/x-ncl-time".split(",");
if(null!=a.type)if(a.type=a.type.toLowerCase(),-1==jQuery.inArray(a.type,values))Logger.error(ERR_INVALID_ATTR_VALUE,b,["type",a.type,values]);else if(null!=a.src){var c=a.src.split(".");a._ext=c[c.length-1].toLowerCase();c=a._ext;switch(a.type){case "text/html":"htm"!=c&&"html"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"text/html",["htm","html"]]);break;case "text/plain":"txt"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"text/plain",["txt"]]);break;case "text/css":"css"!=
c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"text/css",["css"]]);break;case "text/xml":"xml"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"text/xml",["xml"]]);break;case "image/bmp":"bmp"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"image/bmp",["bmp"]]);break;case "image/png":"png"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"image/png",["png"]]);break;case "image/gif":"gif"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"image/gif",["gif"]]);break;
case "image/jpeg":"jpg"!=c&&"jpeg"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"image/jpeg",["jpg","jpeg"]]);break;case "audio/basic":"wav"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"audio/basic",["wav"]]);break;case "audio/mp3":"mp3"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"audio/mp3",["mp3"]]);break;case "audio/mp2":"mp2"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"audio/mp2",["mp2"]]);break;case "audio/mpeg":"mpeg"!=c&&"mpg"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,
b,[c,"audio/mpeg",["mpeg","mpg"]]);break;case "audio/mpeg4":"mp4"!=c&&"mpg4"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"audio/mpeg4",["mp4","mpg4"]]);break;case "video/mpeg":"mpeg"!=c&&"mpg"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"video/mpeg",["mpeg","mpg"]]);break;case "application/x-ginga-NCLua":"lua"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"application/x-ginga-NCLua",["lua"]]);break;case "application/x-ginga-NCLet":"class"!=c&&"jar"!=c&&Logger.error(Logger.ERR_INCOMPATIBLE_FILE_EXT,
b,[c,"application/x-ginga-NCLet",["class","jar"]])}}};Parser.prototype.parseMetadata=function(){};Parser.prototype.parseMeta=function(){};Parser.prototype.parseNCL=function(a,b){values=["http://www.ncl.org.br/NCL3.0/EDTVProfile","http://www.ncl.org.br/NCL3.0/BDTVProfile","http://www.ncl.org.br/NCL3.0/CausalConnectorProfile"];null!=a.xmlns&&-1==jQuery.inArray(a.xmlns,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["xmlns",a.xmlns,values])};Parser.prototype.parsePort=function(){};Parser.prototype.parseProperty=function(a,b){if("explicitDur"==a.name){values=["(n\u00famero real)s","HH:MM:SS"];patt1=/^(\d+|\d*\.\d+)s$/;patt2=/^\d+:\d+:\d+(\.\d+)?$/;var c;a.value=a.value.replace(/\s/g,"");c=0==a.value.length?4:patt1.test(a.value)?1:patt2.test(a.value)?2:0;if(0==c)Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["value",a.value,values]);else switch(c){case 1:a.value=parseFloat(a.value.split("s")[0]);break;case 2:var d=a.value.split(":");c=parseFloat(d[0]);var e=parseFloat(d[1]),d=
parseFloat(d[2]);60<=e||60<=d?Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["value",a.value,values]):a.value=3600*parseFloat(c)+60*parseFloat(e)+parseFloat(d)}}};Parser.prototype.parseRegionBase=function(a,b){values=["systemScreen(i)","systemAudio(i)"];patt=/^systemScreen\(\d+\)$|^systemAudio\(\d+\)$/;null!=a.device&&!patt.test(a.device)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["device",a.device,values])};Parser.prototype.parseRegion=function(a,b,c){a._parent=c;attrs="left,right,top,bottom,height,width".split(",");values=["(n\ufffdmero inteiro)","(n\ufffdmero inteiro)px","(n\ufffdmero real)%"];for(var d in attrs)attr=attrs[d],value=a[attr],null!=value&&(patt=/^(\d+|\d*\.\d+)px$|^(\d+|\d*\.\d+)%$|^(\d+|\d*\.\d+)$/,patt.test(value)||Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,[attr,value,values]));a.left&&a.right&&a.width&&isFinite(a.left)&&isFinite(a.right)&&isFinite(a.width)&&isFinite(c.width)&&(d=
parseInt(a.left)+parseInt(a.right)+parseInt(a.width),d!=c.width&&Logger.warning(Logger.WARN_INVALID_REGION_DIMENSIONS,"region",[["left","right","width"],d,c.width]));a.top&&a.bottom&&a.height&&isFinite(a.top)&&isFinite(a.bottom)&&isFinite(a.height)&&isFinite(c.height)&&(d=parseInt(a.top)+parseInt(a.bottom)+parseInt(a.height),d!=c.height&&Logger.warning(Logger.WARN_INVALID_REGION_DIMENSIONS,"region",[["top","bottom","height"],d,c.height]));values=["n\ufffdmero inteiro entre 0 e 255"];patt=/^\d+$/;
null!=a.zIndex&&(!patt.test(a.zIndex)||0>a.zIndex||255<a.zIndex)?Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["zIndex",a.zIndex,values]):(this.uniqueTable.zIndex||(this.uniqueTable.zIndex=[]),this.uniqueTable.zIndex[a.zIndex]?this.uniqueTable.zIndex[a.zIndex].duplicated||(this.uniqueTable.zIndex[a.zIndex].duplicated=!0,Logger.warning(Logger.WARN_DUPLICATED_ZINDEX,"region",[a.zIndex])):this.uniqueTable.zIndex[a.zIndex]={id:a.id,duplicated:!1})};Parser.prototype.parseRuleBase=function(){};Parser.prototype.parseRule=function(a,b){values="eq,ne,gt,lt,gte,lte".split(",");null!=a.comparator&&-1==jQuery.inArray(a.comparator,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["comparator",a.comparator,values])};Parser.prototype.parseSimpleAction=function(a,b,c,d){values="start,stop,abort,pause,resume,set".split(",");null!=a.role&&-1==jQuery.inArray(a.role,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["role",a.role,values]);null!=a.role&&(-1==jQuery.inArray(a.role,values)?Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["role",a.role,values]):(c=d.split("causalConnector#")[1].split(">")[0],this.uniqueTable["id#"+c]||(this.uniqueTable["id#"+c]=[]),this.uniqueTable["id#"+c][a.role]?this.uniqueTable["id#"+
c][a.role].duplicated||(this.uniqueTable["id#"+c][a.role].duplicated=!0,Logger.error(Logger.ERR_DUPLICATED_ATTR,"role",[a.role,c,["simpleAction","simpleCondition","attributeAssessment"]])):this.uniqueTable["id#"+c][a.role]={duplicated:!1}));values=["start","stop","abort","pause","resume"];null!=a.actionType&&-1==jQuery.inArray(a.actionType,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["actionType",a.actionType,values]);values=["presentation","selection","attribution"];null!=a.eventType&&
-1==jQuery.inArray(a.eventType,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["eventType",a.eventType,values]);null==a.value&&("attribution"==a.eventType||"set"==a.role)&&Logger.error(Logger.ERR_MISSING_ATTR,b,["value"]);values=["(n\u00famero inteiro entre 1 e max)"];patt=/^\d+$/;null!=a.min&&(patt.test(a.min)?(1>parseInt(a.min)||null!=a.max&&"unbounded"!=a.max&&parseInt(a.max)<parseInt(a.min))&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["min",a.min,values]):Logger.error(Logger.ERR_INVALID_ATTR_VALUE,
b,["min",a.min,values]));values=["(n\u00famero inteiro maior ou igual a min)","unbounded"];patt=/^(\d+|unbounded)$/;null!=a.max&&(patt.test(a.max)?"unbounded"!=a.max&&(1>parseInt(a.max)||null!=a.min&&parseInt(a.max)<parseInt(a.min))&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["max",a.max,values]):Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["max",a.max,values]));values=["par","seq"];null==a.qualifier?null!=a.min&&1<parseInt(a.min)?Logger.error(Logger.ERR_MISSING_ATTR,b,["qualifier"]):null!=a.max&&
("unbounded"==a.max||1<parseInt(a.max))&&Logger.error(Logger.ERR_MISSING_ATTR,b,["qualifier"]):-1==jQuery.inArray(a.qualifier,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["qualifier",a.qualifier,values]);values=["(n\u00famero inteiro positivo)"];patt=/^\d+$/;null!=a.repeat&&!patt.test(a.repeat)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["repeat",a.repeat,values]);values=["(n\u00famero real positivo)s"];patt=/^(\d+|\d*\.\d+)s$/;null!=a.duration&&!patt.test(a.duration)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,
b,["duration",a.duration,values])};Parser.prototype.parseSimpleCondition=function(a,b,c,d){values="onBegin,onEnd,onAbort,onPause,onResume,onSelection,onBeginAttribution,onEndAttribution".split(",");null!=a.role&&-1==jQuery.inArray(a.role,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["role",a.role,values]);null!=a.role&&(-1==jQuery.inArray(a.role,values)?Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["role",a.role,values]):(c=d.split("causalConnector#")[1].split(">")[0],this.uniqueTable["id#"+c]||(this.uniqueTable["id#"+c]=
[]),this.uniqueTable["id#"+c][a.role]?this.uniqueTable["id#"+c][a.role].duplicated||(this.uniqueTable["id#"+c][a.role].duplicated=!0,Logger.error(Logger.ERR_DUPLICATED_ATTR,"role",[a.role,c,["simpleAction","simpleCondition","attributeAssessment"]])):this.uniqueTable["id#"+c][a.role]={duplicated:!1}));values=["starts","stops","pauses","resumes","aborts"];null!=a.transition&&-1==jQuery.inArray(a.transition,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["transition",a.transition,values]);values=
["presentation","selection","attribution"];null!=a.eventType&&-1==jQuery.inArray(a.eventType,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["eventType",a.eventType,values]);values="VARIAVEL,0-9,A-Z,*,#,MENU,INFO,GUIDE,CURSOR_DOWN,CURSOR_LEFT,CURSOR_RIGHT,CURSOR_UP,CHANNEL_DOWN,CHANNEL_UP,VOLUME_DOWN,VOLUME_UP,ENTER,RED,GREEN,YELLOW,BLUE,BACK,EXIT,POWER,REWIND,STOP,EJECT,PLAY,RECORD,PAUSE".split(",");patt=/^([0-9A-Z]|\*|\$[A-Za-z_][0-9A-Za-z_]*|#|MENU|INFO|GUIDE|CURSOR_DOWN|CURSOR_LEFT|CURSOR_RIGHT|CURSOR_UP|CHANNEL_DOWN|CHANNEL_UP|VOLUME_DOWN|VOLUME_UP|ENTER|RED|GREEN|YELLOW|BLUE|BACK|EXIT|POWER|REWIND|STOP|EJECT|PLAY|RECORD|PAUSE)$/;
null!=a.key&&!patt.test(a.key)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["key",a.key,values]);values=["(n\ufffdmero inteiro entre 1 e max)"];patt=/^\d+$/;null!=a.min&&(patt.test(a.min)?(1>parseInt(a.min)||null!=a.max&&"unbounded"!=a.max&&parseInt(a.max)<parseInt(a.min))&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["min",a.min,values]):Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["min",a.min,values]));values=["(n\ufffdmero inteiro maior ou igual a min)","unbounded"];patt=/^(\d+|unbounded)$/;
null!=a.max&&(patt.test(a.max)?"unbounded"!=a.max&&(1>parseInt(a.max)||null!=a.min&&parseInt(a.max)<parseInt(a.min))&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["max",a.max,values]):Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["max",a.max,values]));values=["and","or"];null==a.qualifier?null!=a.min&&1<parseInt(a.min)?Logger.error(Logger.ERR_MISSING_ATTR,b,["qualifier"]):null!=a.max&&("unbounded"==a.max||1<parseInt(a.max))&&Logger.error(Logger.ERR_MISSING_ATTR,b,["qualifier"]):-1==jQuery.inArray(a.qualifier,
values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["qualifier",a.qualifier,values])};Parser.prototype.parseSwitch=function(){};Parser.prototype.parseSwitchPort=function(){};Parser.prototype.parseTransitionBase=function(){};Parser.prototype.parseTransition=function(a,b){values=["barWipe","irisWipe","clockWipe","snakeWipe","fade"];null!=a.type&&-1==jQuery.inArray(a.type,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["type",a.type,values]);values=["(n\u00famero real positivo)s"];patt=/^(\d+|\d*\.\d+)s$/;null!=a.dur&&!patt.test(a.dur)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["dur",a.dur,values]);values=["(n\u00famero real entre 0 e 1)"];patt=/^(0*\.\d+|1\.0)$/;null!=a.startProgress&&!patt.test(a.startProgress)&&
Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["startProgress",a.startProgress,values]);null!=a.endProgress&&!patt.test(a.endProgress)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["endProgress",a.endProgress,values]);values=["forward","reverse"];null!=a.direction&&-1==jQuery.inArray(a.direction,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["direction",a.direction,values]);values="white,black,silver,gray,red,maroon,fuchsia,purple,lime,green,yellow,olive,blue,navy,aqua,teal".split(",");null!=
a.fadeColor&&-1==jQuery.inArray(a.fadeColor,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["fadeColor",a.fadeColor,values]);values=["(n\u00famero inteiro n\u00e3o negativo)"];patt=/^\d+$/;null!=a.horRepeat&&-1==patt.test(a.horRepeat,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["horRepeat",a.horRepeat,values]);values=["(n\u00famero inteiro n\u00e3o negativo)"];patt=/^\d+$/;null!=a.vertRepeat&&-1==patt.test(a.vertRepeat,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["vertRepeat",
a.vertRepeat,values]);values=["(n\u00famero inteiro n\u00e3o negativo)"];patt=/^\d+$/;null!=a.borderWidth&&-1==patt.test(a.borderWidth,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["borderWidth",a.borderWidth,values]);values="white,black,silver,gray,red,maroon,fuchsia,purple,lime,green,yellow,olive,blue,navy,aqua,teal,blend".split(",");null!=a.borderColor&&-1==jQuery.inArray(a.borderColor,values)&&Logger.error(Logger.ERR_INVALID_ATTR_VALUE,b,["borderColor",a.borderColor,values])};Parser.prototype.parseValueAssessment=function(){};
