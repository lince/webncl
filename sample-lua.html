<html>
	<head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
		<!-- Styles -->
		<link rel="stylesheet" type="text/css" href="css/webncl.css" />
		<!-- Bibliotecas -->
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
		<script type="text/javascript" src="js/popcorn.js"></script>
		<script type="text/javascript" src="js/lua+parser.min.js"></script>
		<script type="text/javascript" src="js/amq_jquery_adapter.js"></script>
		<script type="text/javascript" src="js/amq.js"></script>
		<!-- Parser -->
		<script type="text/javascript" src="js/src/parser/Parser.js"></script>
		<script type="text/javascript" src="js/src/parser/grammar.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/ncl.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/head.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/body.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/regionBase.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/region.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/media.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/context.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/area.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/port.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/property.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/switch.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/switchPort.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/mapping.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/descriptor.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/descriptorParam.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/descriptorBase.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/link.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/bind.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/linkParam.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/bindParam.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/connectorParam.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/assessmentStatement.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/attributeAssessment.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/valueAssessment.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/compoundStatement.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/simpleCondition.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/compoundCondition.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/simpleAction.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/compoundAction.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/causalConnector.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/connectorBase.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/ruleBase.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/rule.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/compositeRule.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/bindRule.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/defaultComponent.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/descriptorSwitch.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/defaultDescriptor.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/importBase.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/importedDocumentBase.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/importNCL.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/transitionBase.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/transition.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/meta.js"></script>
		<script type="text/javascript" src="js/src/parser/tags/metadata.js"></script>
		<!-- Player -->
		<script type="text/javascript" src="js/src/player/Player.js"></script>
		<script type="text/javascript" src="js/src/player/ContextPlayer.js"></script>
		<script type="text/javascript" src="js/src/player/MediaPlayer.js"></script>
        <script type="text/javascript" src="js/src/player/Html5Player.js"></script>
        <script type="text/javascript" src="js/src/player/FlowPlayer.js"></script>
		<script type="text/javascript" src="js/src/player/LuaPlayer.js"></script>
		<!-- Formatter -->
		<script type="text/javascript" src="js/src/formatter/SystemSettings.js"></script>
		<script type="text/javascript" src="js/src/formatter/InputManager.js"></script>
		<script type="text/javascript" src="js/src/formatter/Listener.js"></script>
		<!-- Main -->
		<script type="text/javascript" src="js/src/TimerManager.js"></script>
		<script type="text/javascript" src="js/src/Logger.js"></script>
		<script type="text/javascript" src="js/src/WebNCL.js"></script>
		<!--libLua -->
		<script type="text/javascript" src="js/src/lua/libCanvas.js"></script>
		<script type="text/javascript" src="js/src/lua/libPersistent.js"></script>
		<script type="text/javascript" src="js/src/lua/libEvents.js"></script>
		<script type="text/javascript" src="js/src/lua/libBroker.js"></script>

	</head>
<body>

	<div id="myPlayer3"
		style="position: relative; width: 500px; height: 500px"></div>

	<script>
var gPreloadImages=[];
var gMainRunAfterPreloadFinished = false;

function MainOnLoad (preload_image_list, ncl, container) {
	if (preload_image_list && preload_image_list.length > 0) {
		// preload images before starting, MainRunAfterPreloadFinished() will be called when all are done loading
		for (k in preload_image_list) {
			var url = preload_image_list[k];
			//~ MainPrint("preload image:"+url);
			var img = new Image();
			gPreloadImages[url] = img;
			img.myurl = url; // img.src might be transformed to absolute path etc, so keep this as array-key
			img.onload = function() { PreLoadImageFinishOne(this.myurl,ncl, container); }
		}
		for (k in preload_image_list) {
			var url = preload_image_list[k];
			gPreloadImages[url].src = url; // start loading here after the list has been filled in case of instant .onload call
		}
	} else {
		// no preload list available, start immediately
		runNCL(ncl, container);
	}
}

function PreLoadImageFinishOne (url,ncl, container) {
	//~ MainPrint("preload image finished:"+url);
	for (k in gPreloadImages) if (k != url && !gPreloadImages[k].complete) return; // still more to do
	if (gMainRunAfterPreloadFinished) return; // only call once
	gMainRunAfterPreloadFinished = true;
	runNCL(ncl, container); // preload for all images finished
}

function runNCL(ncl, container){
 	var myPlayer3 = new WebNclPlayer(ncl, container);
	myPlayer3.start();	
}
	
//MainOnLoad([],'sample/sample-lua.ncl','myPlayer3');

MainOnLoad(['test_lua/runner/runner.png'],'test_lua/runner/main.ncl','myPlayer3');

//MainOnLoad([],'test_lua/exemplo_04/main.ncl','myPlayer3');

//MainOnLoad(['test_lua/exemplo_03/monkey.png', 'test_lua/exemplo_03/banana.png'],'test_lua/exemplo_03/main.ncl','myPlayer3');

	</script>
	
</body>
</html>
